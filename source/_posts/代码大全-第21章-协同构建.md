---
title: 第21章 协同构建
date: 2026-02-17 15:25:09
categories:
- [软件工程, 理论]
tags:
- 代码大全
---
协同构建的核心思想：**通过多人协作来提高软件质量**。所有协同构建技术的共同目标都是利用"他人的眼睛"来发现自己看不到的缺陷，同时分享知识、提升团队整体水平。

---

## 21.1 协同开发实践概述

- 协同构建是指由**多名开发者共同承担创建代码及其他工作产品责任**的技术
- 协同构建包括：**结对编程、正式检查、非正式评审、文档阅读**等
- 协同构建的核心价值在于：**其他人总能发现你自己发现不了的错误**
- 协同构建除了能发现错误，还能**传播项目知识、提高代码质量、促进团队协作文化**

### 协同构建是对测试的补充，而非替代

- 协同构建能发现测试难以发现的**系统性错误**和**设计缺陷**
- 测试通常只能发现**个别缺陷**，而评审可以同时发现**缺陷与其根本原因**
- 研究表明，评审的缺陷检出率可以达到 **50%–70%**，甚至更高，而测试的检出率通常在 **25%–35%**
- **将协同构建与测试结合使用**，可以获得远高于单独使用任一方法的缺陷清除率

## 21.2 结对编程（Pair Programming）

结对编程是指**两名程序员在同一台计算机上协作编程**的实践。

### 结对编程的关键要素

- 一人**编写代码（驾驶员）**，另一人**审查并思考战略（领航员）**
- 两人应**定期交换角色**
- 结对双方应具有**相近的技术水平**，否则容易变成单方面的指导课
- 领航员不是被动观看，而是在**更高的抽象层次上思考**：这段代码是否正确？是否有遗漏的测试用例？有没有更好的设计？

### 结对编程的好处

- 与独自编程相比，结对编程能**写出更高质量的代码**
- 能让人保持**专注**，减少偷懒和走神
- 产生**更好的代码设计**
- 促进**知识传播**：每段代码至少有两个人了解
- 建立起**共同的代码所有权（collective ownership）**

### 结对编程的注意事项

- **不要让结对变成旁观**：两个人都要积极参与
- **不要强制推行**结对编程，要让开发者自愿参与
- 定期**轮换搭档**，避免形成固定的小圈子
- 对于**简单的任务**，结对可能不划算——适合用在复杂或关键的部分
- 鼓励结对双方在风格和方法上**互相挑战**

## 21.3 正式检查（Formal Inspections）

正式检查（Inspection）是一种**高度结构化的评审方式**，由 Michael Fagan 在 IBM 提出，是目前已知最有效的缺陷检测方法之一。

### 正式检查与普通评审的区别

|  | 正式检查 | 走查/非正式评审 |
| --- | --- | --- |
| **角色分工** | 有明确角色（主持人、作者、评审员、记录员） | 角色模糊 |
| **使用检查单** | 有针对性的检查清单 | 通常没有 |
| **重点** | 发现缺陷 | 可能偏向讨论解决方案 |
| **数据收集** | 收集度量数据以改进流程 | 通常不收集 |
| **流程** | 遵循严格的流程 | 相对随意 |

### 正式检查中的角色

- **主持人（Moderator）**：负责组织和控制检查会议的节奏，确保聚焦于**发现缺陷而非修复缺陷**
- **作者（Author）**：代码的编写者，在会议中**回答问题但不主导讨论**
- **评审员（Reviewer）**：事先独立审查代码，在会议上**提出发现的问题**
- **记录员（Scribe）**：记录发现的所有缺陷和讨论要点，通常不应由作者担任

### 正式检查的一般流程

1. **计划**：主持人分发材料，安排日程
2. **概述（可选）**：作者向评审员介绍被检查的代码或设计
3. **准备**：每位评审员**独立审查**材料，使用检查清单记录发现的问题
4. **检查会议**：评审员逐一提出发现的缺陷，记录员做记录。**会议聚焦于发现问题，不讨论如何修复**
5. **返工**：作者根据检查会议的记录**修复所有缺陷**
6. **跟踪**：主持人**确认所有缺陷都已修复**

### 正式检查的关键准则

- 检查会议的速度不应超过每小时 **150–200 行非注释源代码**
- 准备时间不应低于检查会议时间（评审员需要充分的独立审查时间）
- 检查的目的是**发现缺陷**，而不是纠正缺陷，更不是评判作者能力
- **管理层不应参加**检查会议，以免造成压力和防御心理
- 对检查结果进行**度量和分析**，持续改进检查流程

<aside>
💡

**检查清单非常重要**：为你所用的语言和项目维护一份专用的检查清单。不断根据历史缺陷数据更新清单，使其越来越有针对性。

</aside>

## 21.4 其他协同开发实践

### 走查（Walkthroughs）

- 由代码**作者主导**，向同事"走"一遍代码的逻辑
- 比正式检查更轻量，但效果也更依赖个人
- 重点在于**教育和知识传递**，同时也能捕获一些缺陷
- 缺点：因为作者主导讲解，评审员容易被带着走，不如独立审查有效

### 代码阅读（Code Reading）

- 评审员**独立阅读代码**并记录发现的问题，然后将意见反馈给作者
- 不需要召开会议，每个人按自己的节奏进行
- 研究表明，**独立的代码阅读在发现缺陷方面可能比检查会议本身还有效**
- 适用于团队成员分布在不同地点或时区的情况

### "狗食"（Dog and Pony Shows）

- 向客户或高层管理者展示软件的评审方式
- 主要目的是**获取反馈和管理期望**，而非发现技术缺陷

## 21.5 协同构建技术的比较

| **技术** | **缺陷发现效率** | **成本** | **适用场景** |
| --- | --- | --- | --- |
| 正式检查 | 高（50%–70%） | 较高 | 关键代码、高风险模块 |
| 结对编程 | 中高 | 中等 | 复杂任务、新手培训 |
| 走查 | 中等（20%–40%） | 较低 | 日常评审、知识分享 |
| 代码阅读 | 中高 | 低 | 分布式团队、异步协作 |

---

## 本章核心检查清单

- [ ]  是否有将协同构建引入开发流程的计划（正式检查、结对编程、走查等）？
- [ ]  正式检查是否有明确的角色分工（主持人、作者、评审员、记录员）？
- [ ]  评审是否聚焦于**发现缺陷**而非**讨论解决方案**？
- [ ]  评审员是否有充分的**独立准备时间**？
- [ ]  是否有针对项目和语言的**检查清单**？
- [ ]  管理层是否被隔离在检查会议之外？
- [ ]  检查结果是否被用于**改进开发流程**，而不是评估个人绩效？
- [ ]  结对编程中，两人是否都在积极参与？
- [ ]  是否根据任务复杂度选择了合适的协同构建方式？

---

## 要点总结

> **协同构建**是提升软件质量最有效的手段之一。正式检查是已知最高效的缺陷发现技术，而结对编程、走查和代码阅读各有所长。关键原则是：**让他人的眼睛帮你找到自己的盲点**，同时通过协作传播知识、建立集体代码所有权。根据项目需求和团队情况，灵活组合使用各种协同构建技术。
>