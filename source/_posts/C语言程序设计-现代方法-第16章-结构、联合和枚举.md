---
title: ç¬¬16ç«  ç»“æ„ã€è”åˆå’Œæšä¸¾
date: 2026-02-17 02:20:29
categories:
- [ç¼–ç¨‹æŠ€æœ¯, C]
tags:
- Cè¯­è¨€ç¨‹åºè®¾è®¡-ç°ä»£æ–¹æ³•
---
## 16.1 ç»“æ„å˜é‡

### ç»“æ„å˜é‡çš„å£°æ˜

ç»“æ„ï¼ˆstructureï¼‰æ˜¯ä¸€ç§å°†**ä¸åŒç±»å‹**çš„æ•°æ®ç»„åˆåœ¨ä¸€èµ·çš„å¤åˆç±»å‹ã€‚å£°æ˜ç»“æ„å˜é‡æœ€ç®€å•çš„æ–¹å¼ï¼š

```c
struct {
    int number;
    char name[NAME_LEN + 1];
    int on_hand;
} part1, part2;
```

- `part1` å’Œ `part2` å„è‡ªæ‹¥æœ‰ `number`ã€`name`ã€`on_hand` ä¸‰ä¸ª**æˆå‘˜**ï¼ˆmemberï¼‰
- ç»“æ„çš„æˆå‘˜å­˜å‚¨åœ¨**è¿ç»­çš„å†…å­˜åŒºåŸŸ**ä¸­ï¼ˆä½†å¯èƒ½æœ‰å¡«å……å­—èŠ‚ï¼‰

### ç»“æ„å˜é‡çš„åˆå§‹åŒ–

å£°æ˜æ—¶å¯ä»¥ç”¨èŠ±æ‹¬å·åˆå§‹åŒ–ï¼š

```c
struct {
    int number;
    char name[NAME_LEN + 1];
    int on_hand;
} part1 = {528, "Disk drive", 10},
  part2 = {914, "Printer cable", 5};
```

- åˆå§‹åŒ–å€¼æŒ‰æˆå‘˜**å£°æ˜é¡ºåº**ä¾æ¬¡èµ‹å€¼
- æœªæŒ‡å®šçš„æˆå‘˜è‡ªåŠ¨åˆå§‹åŒ–ä¸º **0**ï¼ˆæ•°å€¼ç±»å‹ï¼‰æˆ– **ç©ºå­—ç¬¦ä¸²**ï¼ˆå­—ç¬¦æ•°ç»„ï¼‰

### C99 æŒ‡å®šåˆå§‹åŒ–å™¨

C99 å…è®¸æŒ‰**æˆå‘˜å**åˆå§‹åŒ–ï¼Œé¡ºåºæ— å…³ï¼š

```c
struct {
    int number;
    char name[NAME_LEN + 1];
    int on_hand;
} part1 = {.on_hand = 10, .name = "Disk drive", .number = 528};
```

<aside>
ğŸ’¡

æŒ‡å®šåˆå§‹åŒ–å™¨å¯ä»¥åªåˆå§‹åŒ–éƒ¨åˆ†æˆå‘˜ï¼ŒæœªæåŠçš„æˆå‘˜é»˜è®¤ä¸º 0ã€‚è¿™ç§å†™æ³•æ¯”æŒ‰é¡ºåºåˆå§‹åŒ–**æ›´å®‰å…¨**ï¼Œä¸ä¼šå› ä¸ºæˆå‘˜é¡ºåºè°ƒæ•´è€Œå‡ºé”™ã€‚

</aside>

### å¯¹ç»“æ„çš„æ“ä½œ

ä½¿ç”¨ `.` è¿ç®—ç¬¦ï¼ˆ**æˆå‘˜è®¿é—®è¿ç®—ç¬¦**ï¼‰è®¿é—®ç»“æ„æˆå‘˜ï¼š

```c
part1.number = 258;
part1.on_hand = 20;

printf("Part number: %d\n", part1.number);
printf("Part name: %s\n", part1.name);
```

ç»“æ„æ”¯æŒ**èµ‹å€¼**æ“ä½œï¼ˆé€æˆå‘˜å¤åˆ¶ï¼‰ï¼š

```c
part2 = part1;  // å°† part1 çš„æ‰€æœ‰æˆå‘˜å¤åˆ¶åˆ° part2
```

<aside>
âš ï¸

ç»“æ„ä¸èƒ½ç”¨ `==` æˆ– `!=` ç›´æ¥æ¯”è¾ƒï¼å¿…é¡»é€ä¸ªæˆå‘˜æ¯”è¾ƒï¼Œæˆ–ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°ã€‚

</aside>

## 16.2 ç»“æ„ç±»å‹

### ç»“æ„æ ‡è®°

ä½¿ç”¨**ç»“æ„æ ‡è®°**ï¼ˆstructure tagï¼‰ç»™ç»“æ„ç±»å‹å‘½åï¼Œä»¥ä¾¿å¤ç”¨ï¼š

```c
struct part {
    int number;
    char name[NAME_LEN + 1];
    int on_hand;
};
```

ä¹‹åç”¨æ ‡è®°å£°æ˜å˜é‡ï¼š

```c
struct part part1, part2;
```

<aside>
âš ï¸

æ³¨æ„ `struct part` æ•´ä½“æ‰æ˜¯ç±»å‹åï¼Œä¸èƒ½çœç•¥ `struct` å…³é”®å­—ï¼ˆä¸ C++ ä¸åŒï¼‰ã€‚`part` æœ¬èº«ä¸æ˜¯ç±»å‹åã€‚

</aside>

### ç»“æ„ç±»å‹çš„å®šä¹‰ï¼ˆtypedefï¼‰

ç”¨ `typedef` ä¸ºç»“æ„ç±»å‹åˆ›å»ºåˆ«åï¼Œé¿å…æ¯æ¬¡éƒ½å†™ `struct`ï¼š

```c
typedef struct {
    int number;
    char name[NAME_LEN + 1];
    int on_hand;
} Part;

Part part1, part2;   // ä¸éœ€è¦ struct å…³é”®å­—
```

<aside>
ğŸ“Œ

`typedef` æ–¹å¼æ›´ç®€æ´ï¼Œä½†åœ¨éœ€è¦**è‡ªå¼•ç”¨**çš„ç»“æ„ï¼ˆå¦‚é“¾è¡¨èŠ‚ç‚¹ï¼‰ä¸­ï¼Œå¿…é¡»ä½¿ç”¨ç»“æ„æ ‡è®°ï¼š

```c
struct node {
    int value;
    struct node *next;   // è‡ªå¼•ç”¨ï¼Œå¿…é¡»ç”¨æ ‡è®°
};
```

</aside>

### ç»“æ„ä½œä¸ºå‚æ•°å’Œè¿”å›å€¼

ç»“æ„å¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°å’Œè¿”å›å€¼ï¼Œä¼ é€’æ—¶æ˜¯**å€¼ä¼ é€’**ï¼ˆæ•´ä½“å¤åˆ¶ï¼‰ï¼š

```c
// ä½œä¸ºå‚æ•°
void print_part(struct part p) {
    printf("Number: %d\n", p.number);
    printf("Name: %s\n", p.name);
    printf("On hand: %d\n", p.on_hand);
}

// ä½œä¸ºè¿”å›å€¼
struct part build_part(int number, const char *name, int on_hand) {
    struct part p;
    p.number = number;
    strcpy(p.name, name);
    p.on_hand = on_hand;
    return p;
}
```

<aside>
ğŸ’¡

ä¼ é€’å¤§å‹ç»“æ„æ—¶ï¼Œå€¼ä¼ é€’ä¼š**å¤åˆ¶æ•´ä¸ªç»“æ„**ï¼Œå¼€é”€è¾ƒå¤§ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œé€šå¸¸ä¼ é€’**æŒ‡å‘ç»“æ„çš„æŒ‡é’ˆ**ï¼š

```c
void print_part(const struct part *p) {
    printf("Number: %d\n", p->number);
}
```

</aside>

### æŒ‡å‘ç»“æ„çš„æŒ‡é’ˆä¸ -> è¿ç®—ç¬¦

é€šè¿‡æŒ‡é’ˆè®¿é—®ç»“æ„æˆå‘˜æ—¶ï¼Œä½¿ç”¨ `->` è¿ç®—ç¬¦ï¼ˆ**å³ç®­å¤´é€‰æ‹©**ï¼‰ï¼š

```c
struct part *p = &part1;

// ä»¥ä¸‹ä¸¤ç§å†™æ³•ç­‰ä»·ï¼š
(*p).number = 258;    // å…ˆè§£å¼•ç”¨ï¼Œå†ç”¨ . è®¿é—®
p->number = 258;      // ç”¨ -> ç›´æ¥è®¿é—®ï¼ˆæ¨èï¼‰
```

<aside>
ğŸ“Œ

`->` è¿ç®—ç¬¦æ˜¯ `(*p).member` çš„ç®€å†™ï¼Œåœ¨å®é™…ä»£ç ä¸­å‡ ä¹æ€»æ˜¯ä½¿ç”¨ `->` è€Œä¸æ˜¯ `(*p).member`ã€‚

</aside>

## 16.3 åµŒå¥—çš„æ•°ç»„å’Œç»“æ„

### åµŒå¥—ç»“æ„

ç»“æ„çš„æˆå‘˜å¯ä»¥æ˜¯**å¦ä¸€ä¸ªç»“æ„**ï¼š

```c
struct person_name {
    char first[FIRST_LEN + 1];
    char middle_initial;
    char last[LAST_LEN + 1];
};

struct student {
    struct person_name name;
    int id;
    float gpa;
};

struct student s1;
strcpy(s1.name.first, "Fred");   // å¤šå±‚ . è®¿é—®åµŒå¥—æˆå‘˜
s1.name.middle_initial = 'S';
```

### ç»“æ„æ•°ç»„

æ•°ç»„çš„æ¯ä¸ªå…ƒç´ å¯ä»¥æ˜¯ç»“æ„ï¼š

```c
struct part inventory[100];

// è®¿é—®ç¬¬ i ä¸ªé›¶ä»¶çš„åç§°
printf("%s\n", inventory[i].name);

// åˆå§‹åŒ–ç»“æ„æ•°ç»„
struct part inventory[3] = {
    {528, "Disk drive", 10},
    {914, "Printer cable", 5},
    {100, "USB cable", 20}
};
```

### ç»“æ„ä¸­çš„æ•°ç»„

ç»“æ„æˆå‘˜å¯ä»¥æ˜¯æ•°ç»„ï¼š

```c
struct student {
    char name[NAME_LEN + 1];
    int grades[NUM_COURSES];
    float avg;
};
```

## 16.4 è”åˆ

### è”åˆçš„åŸºæœ¬æ¦‚å¿µ

è”åˆï¼ˆunionï¼‰ä¸ç»“æ„ç±»ä¼¼ï¼Œä½†æ‰€æœ‰æˆå‘˜**å…±äº«åŒä¸€å—å†…å­˜**ã€‚è”åˆçš„å¤§å°ç­‰äºå…¶**æœ€å¤§æˆå‘˜**çš„å¤§å°ï¼š

```c
union {
    int i;
    double d;
} u;
```

- `u.i` å’Œ `u.d` å ç”¨**åŒä¸€æ®µå†…å­˜**
- åŒä¸€æ—¶åˆ»åªèƒ½æœ‰æ•ˆå­˜å‚¨**ä¸€ä¸ª**æˆå‘˜çš„å€¼
- ç»™ä¸€ä¸ªæˆå‘˜èµ‹å€¼åï¼Œå…¶ä»–æˆå‘˜çš„å€¼å˜å¾—**æ— æ„ä¹‰**

```c
u.i = 42;
printf("%d\n", u.i);     // âœ… è¾“å‡º 42
u.d = 3.14;
printf("%.2f\n", u.d);   // âœ… è¾“å‡º 3.14
printf("%d\n", u.i);     // âŒ æ— æ„ä¹‰ï¼Œd çš„èµ‹å€¼è¦†ç›–äº† i çš„å†…å­˜
```

<aside>
âš ï¸

ä¿®æ”¹è”åˆçš„ä¸€ä¸ªæˆå‘˜ä¼š**ç ´å**å…¶ä»–æˆå‘˜çš„å€¼ã€‚ç¨‹åºå‘˜å¿…é¡»è‡ªè¡Œè®°å½•å½“å‰å­˜å‚¨çš„æ˜¯å“ªä¸ªæˆå‘˜ã€‚

</aside>

### è”åˆæ ‡è®°ä¸ typedef

ä¸ç»“æ„ç±»ä¼¼ï¼Œè”åˆä¹Ÿå¯ä»¥ä½¿ç”¨**æ ‡è®°**æˆ– `typedef`ï¼š

```c
// ä½¿ç”¨æ ‡è®°
union number {
    int i;
    double d;
};
union number n;

// ä½¿ç”¨ typedef
typedef union {
    int i;
    double d;
} Number;
Number n;
```

### è”åˆçš„ç”¨é€”

è”åˆæœ€å¸¸è§çš„ç”¨é€”æ˜¯**èŠ‚çœç©ºé—´**å’Œå®ç°**å˜ä½“ç±»å‹**ï¼ˆtagged unionï¼‰ã€‚é€šè¿‡é…åˆä¸€ä¸ªæ ‡è®°å­—æ®µæ¥åŒºåˆ†å½“å‰å­˜å‚¨çš„æ•°æ®ç±»å‹ï¼š

```c
typedef struct {
    int kind;           // æ ‡è®°ï¼š0 = int, 1 = double
    union {
        int i;
        double d;
    } u;
} Number;

// ä½¿ç”¨
Number n;
n.kind = 0;
n.u.i = 42;

// æ ¹æ® kind å­—æ®µåˆ¤æ–­å¦‚ä½•è¯»å–
if (n.kind == 0)
    printf("%d\n", n.u.i);
else
    printf("%.2f\n", n.u.d);
```

<aside>
ğŸ“Œ

"æ ‡è®°è”åˆ"ï¼ˆtagged unionï¼‰æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œåœ¨ kind å­—æ®µä¸­è®°å½•å½“å‰å­˜å‚¨çš„ç±»å‹ï¼Œè¯»å–å‰å…ˆæ£€æŸ¥ kindï¼Œé¿å…è¯¯è¯»ã€‚

</aside>

### ç”¨è”åˆè¿›è¡Œåˆå§‹åŒ–

è”åˆåªèƒ½åˆå§‹åŒ–**ç¬¬ä¸€ä¸ªæˆå‘˜**ï¼ˆC89ï¼‰ï¼ŒC99 æ”¯æŒæŒ‡å®šåˆå§‹åŒ–å™¨ï¼š

```c
union number n1 = {42};          // åˆå§‹åŒ–ç¬¬ä¸€ä¸ªæˆå‘˜ i
union number n2 = {.d = 3.14};   // C99ï¼šæŒ‡å®šåˆå§‹åŒ– d
```

## 16.5 æšä¸¾

### æšä¸¾ç±»å‹

æšä¸¾ï¼ˆenumerationï¼‰æ˜¯ä¸€ç§å–å€¼ä¸º**ä¸€ç»„å‘½åå¸¸é‡**çš„ç±»å‹ï¼š

```c
enum suit {CLUBS, DIAMONDS, HEARTS, SPADES};
```

- é»˜è®¤æƒ…å†µä¸‹ï¼Œæšä¸¾å¸¸é‡ä» **0** å¼€å§‹ä¾æ¬¡é€’å¢ï¼š`CLUBS = 0, DIAMONDS = 1, HEARTS = 2, SPADES = 3`
- æšä¸¾å¸¸é‡æœ¬è´¨ä¸Šæ˜¯ `int` å€¼

### æŒ‡å®šæšä¸¾å¸¸é‡çš„å€¼

å¯ä»¥æ‰‹åŠ¨æŒ‡å®šæšä¸¾å¸¸é‡çš„å€¼ï¼š

```c
enum suit {CLUBS = 1, DIAMONDS = 2, HEARTS = 3, SPADES = 4};
```

ä¹Ÿå¯ä»¥åªæŒ‡å®šéƒ¨åˆ†ï¼ŒæœªæŒ‡å®šçš„ä»å‰ä¸€ä¸ªå€¼é€’å¢ï¼š

```c
enum color {RED = 1, GREEN, BLUE};
// RED = 1, GREEN = 2, BLUE = 3
```

æšä¸¾å¸¸é‡çš„å€¼å¯ä»¥**ä¸å”¯ä¸€**ï¼Œä¹Ÿå¯ä»¥**ä¸è¿ç»­**ï¼š

```c
enum dept {SALES = 10, HR = 20, IT = 30};
```

### æšä¸¾æ ‡è®°ä¸ typedef

```c
// ä½¿ç”¨æ ‡è®°
enum suit s = HEARTS;

// ä½¿ç”¨ typedef
typedef enum {CLUBS, DIAMONDS, HEARTS, SPADES} Suit;
Suit s = HEARTS;
```

### æšä¸¾ä½œä¸ºæ•´æ•°ä½¿ç”¨

C è¯­è¨€å°†æšä¸¾å€¼è§†ä¸º**æ•´æ•°**ï¼Œå¯ä»¥å‚ä¸æ•´æ•°è¿ç®—ï¼š

```c
enum suit s = HEARTS;
int i = s;          // âœ… i = 2
s = 0;              // âœ… åˆæ³•ï¼Œä½†å¯è¯»æ€§å·®
s++;                // âœ… åˆæ³•ï¼Œs å˜ä¸º SPADES
```

<aside>
ğŸ’¡

è™½ç„¶æšä¸¾å€¼å¯ä»¥å‚ä¸ä»»æ„æ•´æ•°è¿ç®—ï¼Œä½†æœ€ä½³å®è·µæ˜¯**åªä½¿ç”¨å®šä¹‰å¥½çš„æšä¸¾å¸¸é‡**ï¼Œä¸è¦éšæ„ä¸æ•´æ•°æ··ç”¨ï¼Œä»¥ä¿æŒä»£ç å¯è¯»æ€§ã€‚

</aside>

### ç”¨æšä¸¾æ›¿ä»£ #define

æšä¸¾ç›¸æ¯” `#define` å®å®šä¹‰å¸¸é‡çš„ä¼˜åŠ¿ï¼š

```c
// å®å®šä¹‰æ–¹å¼
#define CLUBS    0
#define DIAMONDS 1
#define HEARTS   2
#define SPADES   3

// æšä¸¾æ–¹å¼ï¼ˆæ¨èï¼‰
enum suit {CLUBS, DIAMONDS, HEARTS, SPADES};
```

- æšä¸¾æœ‰**ç±»å‹ä¿¡æ¯**ï¼Œæ›´æ–¹ä¾¿è°ƒè¯•
- æšä¸¾éµå¾ª C çš„**ä½œç”¨åŸŸè§„åˆ™**ï¼Œä¸åƒ `#define` æ˜¯å…¨å±€æ›¿æ¢
- æšä¸¾å€¼ä¼šè¢«**è‡ªåŠ¨ç¼–å·**ï¼Œä¸æ˜“å‡ºé”™

## 16.6 å°ç»“

| æ¦‚å¿µ | è¯­æ³•ç¤ºä¾‹ | ç‰¹ç‚¹ |
| --- | --- | --- |
| ç»“æ„ | `struct part { int n; char s[20]; };` | æˆå‘˜å„è‡ªå ç‹¬ç«‹å†…å­˜ï¼Œå¯åŒæ—¶ä½¿ç”¨ |
| è”åˆ | `union data { int i; double d; };` | æˆå‘˜å…±äº«å†…å­˜ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½ä½¿ç”¨ä¸€ä¸ª |
| æšä¸¾ | `enum suit { CLUBS, DIAMONDS };` | å‘½åæ•´å‹å¸¸é‡ï¼Œé»˜è®¤ä» 0 é€’å¢ |
| æˆå‘˜è®¿é—® | `s.member` / `p->member` | `.` ç”¨äºå˜é‡ï¼Œ`->` ç”¨äºæŒ‡é’ˆ |
| typedef | `typedef struct {...} Part;` | åˆ›å»ºç±»å‹åˆ«åï¼Œç®€åŒ–å£°æ˜ |
| æ ‡è®°è”åˆ | ç»“æ„åŒ…å« kind å­—æ®µ + è”åˆ | å®‰å…¨ä½¿ç”¨è”åˆçš„æƒ¯ç”¨æ¨¡å¼ |

> ç»“æ„ã€è”åˆå’Œæšä¸¾æ˜¯ C è¯­è¨€ä¸­ç»„ç»‡å¤æ‚æ•°æ®çš„ä¸‰å¤§å·¥å…·ã€‚å…³é”®è¦ç‚¹ï¼šç»“æ„çš„æˆå‘˜**å„è‡ªå å†…å­˜**ï¼Œè”åˆçš„æˆå‘˜**å…±äº«å†…å­˜**ï¼›é€šè¿‡æŒ‡é’ˆè®¿é—®ç»“æ„ç”¨ `->` è€Œé `.`ï¼›**æ ‡è®°è”åˆ**æ˜¯å®‰å…¨ä½¿ç”¨è”åˆçš„æ ‡å‡†æ¨¡å¼ï¼›æšä¸¾æä¾›äº†æ¯” `#define` æ›´å®‰å…¨çš„**å‘½åå¸¸é‡**æ–¹æ¡ˆã€‚
>