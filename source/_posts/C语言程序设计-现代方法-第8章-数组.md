---
title: 第8章 数组
date: 2026-02-17 02:20:24
categories:
- [编程技术, C]
---
## 8.1 一维数组

### 数组的声明

数组是一组**相同类型**元素的有序集合，声明时必须指定**大小**：

```c
int a[10];          // 声明一个包含 10 个 int 元素的数组
float prices[5];    // 声明一个包含 5 个 float 元素的数组
```

- 数组长度必须是**常量表达式**（C89）；C99 允许使用变量（变长数组 VLA）
- 数组下标从 **0** 开始，`a[10]` 的合法下标为 `0` ~ `9`

<aside>
⚠️

C 语言**不检查数组下标越界**！访问 `a[10]` 或 `a[-1]` 不会报错，但会导致**未定义行为**，可能覆盖其他数据或导致程序崩溃。

</aside>

### 数组下标

使用 `[]` 运算符访问数组元素：

```c
a[0] = 10;           // 给第一个元素赋值
a[i] = a[i - 1] + 1; // 下标可以是任何整数表达式
```

### 数组的使用示例

```c
// 反转数组
int a[N], temp;
for (int i = 0; i < N / 2; i++) {
    temp = a[i];
    a[i] = a[N - 1 - i];
    a[N - 1 - i] = temp;
}
```

## 8.2 数组初始化

### 初始化列表

声明数组时可以用花括号提供初始值：

```c
int a[5] = {1, 2, 3, 4, 5};
```

### 部分初始化

如果初始化列表比数组短，**剩余元素自动初始化为 0**：

```c
int a[10] = {1, 2, 3};      // a[3]~a[9] 都为 0
int b[100] = {0};            // 所有元素都为 0（常用技巧）
```

<aside>
💡

`int a[100] = {0};` 是将整个数组清零的简便写法。

</aside>

### 省略数组长度

如果提供了初始化列表，可以省略数组长度，编译器自动推断：

```c
int a[] = {1, 2, 3, 4, 5};  // 等价于 int a[5] = {1,2,3,4,5}
```

### C99 指定初始化器

C99 允许**指定**要初始化的元素下标：

```c
int a[10] = {[3] = 30, [7] = 70};
// a[3] = 30, a[7] = 70, 其余为 0
```

- 指定初始化器中的下标不必按顺序
- 未指定的元素初始化为 0

## 8.3 对数组使用 sizeof 运算符

`sizeof` 可以用来计算数组的**总字节数**和**元素个数**：

```c
int a[10];

sizeof(a)              // 整个数组的字节数，通常为 40（10 × 4）
sizeof(a[0])           // 单个元素的字节数，通常为 4
sizeof(a) / sizeof(a[0])  // 数组元素个数 → 10
```

<aside>
📌

常用宏定义：

```c
#define SIZE (sizeof(a) / sizeof(a[0]))
```

这样修改数组大小时不需要到处改数字，也不容易出错。

</aside>

<aside>
⚠️

`sizeof` 用于数组时，数组**不会退化为指针**。但如果数组作为函数参数传递后再用 `sizeof`，得到的是**指针的大小**而不是数组的大小（详见第 12 章）。

</aside>

## 8.4 多维数组

### 二维数组

二维数组可以看作"数组的数组"（矩阵）：

```c
int m[3][4];   // 3 行 4 列的二维数组
```

- `m[i][j]` 访问第 `i` 行第 `j` 列的元素
- 在内存中，二维数组按**行优先**（row-major）存储

### 二维数组的初始化

```c
// 方式一：嵌套花括号（推荐，清晰）
int m[3][4] = {
    {1, 2, 3, 4},
    {5, 6, 7, 8},
    {9, 10, 11, 12}
};

// 方式二：省略内层花括号（按行填充）
int m[3][4] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12};

// 部分初始化：未指定的元素为 0
int m[3][4] = 243d872b-594c-814d-9bd0-0002008717dc;
// 每行只有第一个元素被赋值，其余为 0
```

### 多维数组的遍历

```c
// 遍历二维数组
for (int i = 0; i < 3; i++)
    for (int j = 0; j < 4; j++)
        printf("%d ", m[i][j]);
```

### 更高维数组

C 支持任意维度的数组，但实际中很少使用三维以上的数组：

```c
int cube[2][3][4];   // 三维数组
```

## 8.5 C99 中的变长数组（VLA）

C99 允许使用**变量**指定数组长度，称为**变长数组**（Variable-Length Array）：

```c
int n;
scanf("%d", &n);
int a[n];           // 数组长度在运行时确定
```

### VLA 的限制

- **不能初始化**：`int a[n] = {0};` 是非法的
- **不能是 static 或 extern**：VLA 只能是自动存储期的局部变量
- VLA 的长度在创建后**不可改变**（"变长"是指长度在运行时决定，而非可动态伸缩）

<aside>
📌

VLA 在 **C11** 中变为**可选特性**（编译器可以不支持）。实际项目中，动态大小的数组更常用 `malloc` 分配（详见第 17 章）。

</aside>

### VLA 的典型用途

```c
// 用 VLA 创建 n×n 单位矩阵
void make_identity(int n, double matrix[n][n]) {
    for (int i = 0; i < n; i++)
        for (int j = 0; j < n; j++)
            matrix[i][j] = (i == j) ? 1.0 : 0.0;
}
```

> 数组是 C 语言中最基本的数据结构。关键要点：下标从 **0** 开始、没有**越界检查**、多维数组按**行优先**存储、善用 `sizeof` 计算元素个数。
>