---
title: 第9章 函数
date: 2026-02-17 02:20:24
categories:
- [编程技术, C]
tags:
- C语言程序设计-现代方法
---
## 9.1 函数的定义和调用

### 函数的定义

函数定义的一般形式：

```c
返回类型 函数名(形参列表)
{
    声明
    语句
}
```

示例：

```c
double average(double a, double b)
{
    return (a + b) / 2;
}
```

- **返回类型**：函数返回值的类型；无返回值用 `void`
- **形参列表**：逗号分隔的参数声明；无参数用 `void`
- **函数体**：花括号内的声明和语句

### 函数的调用

```c
double avg = average(3.0, 5.0);  // 调用函数，传入实参
printf("%.1f\n", avg);           // 输出 4.0
```

- **实参**（argument）：调用时传递的值
- **形参**（parameter）：函数定义中声明的变量
- 实参的值被**复制**给形参（值传递）

<aside>
📌

C 语言中函数调用总是**值传递**（pass by value）。形参是实参的副本，修改形参**不会影响**实参。

</aside>

### void 函数

不返回值的函数，返回类型为 `void`：

```c
void print_stars(int n)
{
    for (int i = 0; i < n; i++)
        printf("*");
    printf("\n");
}
```

- `void` 函数中可以用 `return;`（不带值）提前返回
- 也可以省略 `return`，函数执行到末尾自动返回

## 9.2 函数声明

### 为什么需要声明

如果函数在**调用之后**才定义，编译器不知道它的返回类型和参数类型，会产生错误或警告。解决方法是在调用前提供**函数声明**（也称**函数原型**）：

```c
// 函数声明（原型）
double average(double a, double b);

int main(void)
{
    double avg = average(3.0, 5.0);  // 此时编译器已知 average 的信息
    ...
}

// 函数定义
double average(double a, double b)
{
    return (a + b) / 2;
}
```

### 函数原型的形式

```c
返回类型 函数名(形参类型列表);
```

- 参数名可以省略（但建议保留以增加可读性）：

```c
double average(double, double);       // 合法但可读性差
double average(double a, double b);   // 推荐
```

<aside>
💡

将所有函数声明放在源文件**顶部**（`main` 之前）是最简单的组织方式。后续章节中会介绍将声明放入**头文件**的做法。

</aside>

## 9.3 实参

### 实参转换

调用函数时，实参会根据形参类型进行**隐式转换**：

```c
double average(double a, double b);
int x = 3, y = 5;
average(x, y);   // x, y 自动从 int 转为 double
```

### 数组作为实参

数组作为函数参数时，传递的是**指向首元素的指针**，而不是整个数组的副本：

```c
int sum_array(int a[], int n)
{
    int sum = 0;
    for (int i = 0; i < n; i++)
        sum += a[i];
    return sum;
}
```

<aside>
⚠️

因为传递的是指针，函数内部对数组元素的修改**会影响**原数组！这是"值传递"的例外——传递的值是**地址**。

同时，函数无法通过 `sizeof` 获取数组长度，所以通常需要额外传递一个表示**长度**的参数。

</aside>

### 变长数组形参（C99）

C99 中可以在形参中使用变长数组：

```c
int sum_array(int n, int a[n])    // n 必须在 a 之前声明
{
    ...
}

// 二维变长数组
int sum_matrix(int n, int m, int a[n][m])
{
    ...
}
```

## 9.4 return 语句

`return` 语句用于从函数返回一个值，并终止函数执行：

```c
return 表达式;
```

- 返回值的类型会自动转换为函数的返回类型
- `void` 函数中使用 `return;`（无表达式）
- 非 `void` 函数**每条执行路径都应有 `return`**，否则行为未定义

```c
int max(int a, int b)
{
    if (a > b)
        return a;
    else
        return b;
}
```

## 9.5 程序终止

### 从 main 返回

`main` 函数的返回值是程序的**退出状态码**：

- `return 0;`：程序正常结束
- 非零值：表示异常或错误

C99 规定：如果 `main` 末尾没有 `return`，编译器会**隐式返回 0**。

### exit 函数

`<stdlib.h>` 中的 `exit` 函数可以在**任意位置**终止程序：

```c
#include <stdlib.h>

exit(EXIT_SUCCESS);  // 正常终止（等价于 exit(0)）
exit(EXIT_FAILURE);  // 异常终止（等价于 exit(1)）
```

<aside>
📌

`return` 和 `exit` 在 `main` 中效果相同。但在其他函数中，`return` 只返回到调用者，而 `exit` 会**直接终止整个程序**。

</aside>

## 9.6 递归

函数可以**调用自身**，称为**递归**（recursion）：

```c
int factorial(int n)
{
    if (n <= 1)
        return 1;           // 基本情况（终止条件）
    return n * factorial(n - 1);  // 递归调用
}
```

### 递归的要素

1. **基本情况**（base case）：递归终止的条件，防止无限递归
2. **递归步骤**（recursive step）：问题分解为更小的子问题

### 示例：计算幂

```c
int power(int x, int n)
{
    if (n == 0)
        return 1;
    return x * power(x, n - 1);
}
```

### 快速幂（优化版）

```c
int power(int x, int n)
{
    if (n == 0)
        return 1;
    if (n % 2 == 0)
        return power(x * x, n / 2);     // 偶数：x^n = (x²)^(n/2)
    return x * power(x, n - 1);          // 奇数：x^n = x · x^(n-1)
}
```

### 递归的优缺点

| 优点 | 缺点 |
| --- | --- |
| 代码简洁、逻辑清晰 | 函数调用开销（压栈/弹栈） |
| 天然适合分治、树形结构问题 | 深度过大可能导致**栈溢出** |
| 易于证明正确性 | 某些情况下效率不如迭代 |

<aside>
💡

经验法则：如果递归导致大量**重复计算**（如朴素的 Fibonacci 递归），应改用**迭代**或**记忆化**。

</aside>

> 函数是 C 程序的基本构建单元。关键要点：理解**值传递**机制、始终提供**函数原型**、确保每条路径都有 **return**、谨慎使用**递归**。
>