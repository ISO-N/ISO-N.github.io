---
title: 第19章 一般控制问题
date: 2026-02-17 15:25:07
categories:
- [软件工程, 理论]
tags:
- 代码大全
---
## 19.1 布尔表达式

### 用 true 和 false 做布尔判断

- 隐式地比较布尔值与 `true` 和 `false`，不要写 `if (done == true)`，而是写 `if (done)`
- 简化复杂的布尔表达式：把复杂判断拆分成多个中间布尔变量，提高可读性

### 简化复杂的表达式

- **拆分复杂的判断**：引入新的布尔变量来存储中间结果
- **将复杂表达式做成布尔函数**：把复杂判断封装到函数中，通过函数名来说明用途
- **用决策表代替复杂条件**：当条件组合过多时，使用决策表来简化逻辑

### 编写肯定形式的布尔表达式

- 尽量使用肯定的布尔表达式，避免双重否定（如 `if not notFound`）
- 应用德摩根定理简化否定表达式：
    - `not (A and B)` = `(not A) or (not B)`
    - `not (A or B)` = `(not A) and (not B)`

### 用括号使布尔表达式更清晰

- 即使运算符优先级允许省略括号，也应加上括号以提高可读性
- 把逻辑表达式完全括起来，使阅读者不必记忆运算符优先级

### 了解布尔表达式的求值顺序

- 多数语言采用**短路求值**（short-circuit evaluation），如 C/C++、Java
- 不要在布尔表达式中编写依赖求值顺序的副作用代码

### 按照数轴的顺序编写数值表达式

- 把数值比较按照数轴从小到大排列
- 例如：`min <= i && i <= max`，而非 `i >= min && i <= max`

---

## 19.2 复合语句（语句块）

- 把 `{` 和 `}` 成对写出，先写完一对再填充内容
- 用括号来明确条件语句的含义，避免**悬挂 else** 问题（dangling else）

---

## 19.3 空语句

- 空语句容易被忽视，应引起注意
- 建议做法：
    - 创建一个 `DoNothing()` 预处理宏或内联函数来替代空语句
    - 对空语句加注释说明为何此处故意留空

---

## 19.4 驯服危险的深层嵌套

深层嵌套（超过 3-4 层）严重降低可读性，以下是减少嵌套的方法：

### 方法一：通过重复检测条件中的某一部分来简化嵌套

- 拆分条件表达式，将条件的一部分独立出来处理

### 方法二：用 break 块来简化

- 利用 `break` 提前退出循环，减少多层嵌套

### 方法三：把嵌套的 if 转换成一组 if-then-else

- 把嵌套的 if 改写为平行的 if-then-else-if 链
- 等价变换后嵌套层次大幅降低

### 方法四：把嵌套的 if 转换为 case 语句

- 如果判断条件是同一个变量的多个取值，应使用 switch/case

### 方法五：把深层嵌套的代码提炼成子程序

- 最实用的方法之一：将嵌套的代码块提取为独立的子程序
- 不仅降低了嵌套层次，还提高了代码的可重用性

### 方法六：使用面向对象的方法

- 利用多态（polymorphism）替代复杂的条件分支
- 把不同分支的行为封装到不同子类中

### 方法七：重新设计

- 深层嵌套往往意味着设计本身有问题
- 如果以上方法都不理想，就应该重新审视设计方案

---

## 19.5 编程基础：结构化编程

### 结构化编程的三大核心

结构化编程的核心定理（Böhm-Jacopini 定理）：任何程序都可以用以下三种结构来表达：

1. **顺序**（Sequence）：按照语句出现的顺序依次执行
2. **选择**（Selection）：`if-then-else` 语句，根据条件选择执行路径
3. **迭代**（Iteration）：`while-do` 等循环结构，重复执行一段代码

### 关于结构化编程的争议焦点

- 是否可以使用 `break`、`continue`、`return`、`throw` 等跳转语句？
- 纯粹的结构化编程只允许每个子程序有一个入口和一个出口
- 实用主义观点：如果 `break`、`return` 等能提高可读性，可以谨慎使用

---

## 19.6 控制结构与复杂度

### 复杂度的重要性

- 管理复杂度是软件开发的核心技术任务之一
- 程序的复杂度与出错率直接相关

### 用复杂度度量方法来衡量

- **McCabe 圈复杂度**（Cyclomatic Complexity）：
    - 计算方法：从 1 开始，遇到 `if`、`while`、`for`、`and`、`or`、`case` 等关键字各加 1
    - 复杂度参考值：
        - **0-5**：子程序可能还好
        - **6-10**：应想办法简化子程序
        - **10+**：应把子程序的一部分拆分为更小的子程序并调用

### 降低复杂度的一般策略

- 减少决策点的数量（减少 if/case 分支）
- 把复杂逻辑封装到子程序中，以降低调用方的复杂度
- 用查找表替代复杂的逻辑链
- 使用面向对象方法（多态）消除类型判断

---

## 本章核心检查清单

- [ ]  代码中是否避免了用数字 0 和 1 做布尔判断？
- [ ]  布尔表达式是否用的肯定形式？
- [ ]  在数值判断中是否把数字放在了数轴上？
- [ ]  是否避免了深层嵌套（建议不超过 3-4 层）？
- [ ]  是否用 `break`/`return` 等简化了代码结构？
- [ ]  每个子程序的圈复杂度是否在可控范围内（≤10）？
- [ ]  空语句是否有明确的注释标注？