---
title: 第21章 标准库
date: 2026-02-17 02:20:32
categories:
- [编程技术, C]
tags:
- C语言程序设计-现代方法
---
## 21.1 标准库的使用

### 标准库的意义

- C 语言本身非常小，许多功能（I/O、字符串处理、数学运算等）都依赖于**标准库**提供
- 标准库是 C 标准的一部分，**所有符合标准的编译器**都必须提供
- 使用标准库的好处：
    - **可移植性**：标准库函数在所有平台上行为一致
    - **高效性**：库函数通常经过高度优化
    - **安全性**：经过广泛测试，比自己造轮子更可靠

### 使用库函数的方法

使用标准库函数前，需要通过 `#include` 引入对应的**头文件**（header）：

```c
#include <stdio.h>    // printf, scanf 等
#include <string.h>   // strlen, strcpy 等
#include <stdlib.h>   // malloc, free, exit 等
```

<aside>
📌

头文件提供的是**函数声明**（原型）、**类型定义**和**宏定义**，而库函数的**实现**由编译器/链接器自动链接。

</aside>

### 对库函数名称的限制

- 标准库使用的**所有外部名称**（函数名、全局变量名）都是**保留标识符**，程序员不应使用同名的标识符
- 以下划线开头的标识符通常被保留给库实现使用：
    - `_` + 大写字母开头（如 `_Bool`）
    - `__` 双下划线开头

<aside>
⚠️

不要定义与标准库同名的函数或变量。即使当前程序能运行，也可能在其他平台上产生**链接冲突**。

</aside>

## 21.2 C89 标准库概览

C89 标准库包含 **15 个头文件**，按功能分为以下几类：

### 输入/输出

| 头文件 | 功能 |
| --- | --- |
| `<stdio.h>` | 标准输入/输出（printf、scanf、文件操作等） |

### 数学与数值

| 头文件 | 功能 |
| --- | --- |
| `<math.h>` | 数学函数（sin、cos、sqrt、pow 等） |
| `<float.h>` | 浮点类型的特性和限制（宏定义） |
| `<limits.h>` | 整数类型的大小限制（INT_MAX 等） |

### 字符串与字符处理

| 头文件 | 功能 |
| --- | --- |
| `<string.h>` | 字符串操作（strcpy、strcat、strlen 等） |
| `<ctype.h>` | 字符分类与转换（isalpha、toupper 等） |

### 通用工具

| 头文件 | 功能 |
| --- | --- |
| `<stdlib.h>` | 通用工具（内存分配、随机数、排序、转换等） |
| `<stddef.h>` | 常用类型定义和宏（size_t、NULL、offsetof） |
| `<stdarg.h>` | 可变参数列表支持（va_list、va_start 等） |

### 日期与时间

| 头文件 | 功能 |
| --- | --- |
| `<time.h>` | 日期和时间操作（time、clock、strftime 等） |

### 其他

| 头文件 | 功能 |
| --- | --- |
| `<assert.h>` | 断言宏（assert） |
| `<errno.h>` | 错误码（errno） |
| `<locale.h>` | 本地化支持 |
| `<setjmp.h>` | 非局部跳转（setjmp、longjmp） |
| `<signal.h>` | 信号处理 |

## 21.3 C99 标准库的变更

C99 在 C89 的 15 个头文件基础上做了扩充，**新增了 9 个头文件**：

| 头文件 | 功能 |
| --- | --- |
| `<stdbool.h>` | 布尔类型 `bool`、`true`、`false` |
| `<stdint.h>` | 精确宽度整数类型（int32_t、uint64_t 等） |
| `<inttypes.h>` | 整数类型的格式化 I/O 宏 |
| `<complex.h>` | 复数运算 |
| `<tgmath.h>` | 泛型数学宏（自动匹配 float/double/long double 版本） |
| `<fenv.h>` | 浮点环境控制 |
| `<iso646.h>` | 替代拼写（and、or、not 等宏） |
| `<wchar.h>` | 宽字符工具 |
| `<wctype.h>` | 宽字符分类与转换 |

### 对已有头文件的修改

C99 还对已有头文件进行了许多增补：

- **`<stdio.h>`**：新增 `snprintf`、`vscanf` 系列函数
- **`<stdlib.h>`**：新增 `lldiv`、`strtof`、`strtold` 等
- **`<math.h>`**：大幅扩充，新增大量 `float` 和 `long double` 版本的数学函数，以及 `fpclassify`、`isnan`、`isinf` 等宏
- **`<limits.h>`**：新增 `LLONG_MIN`、`LLONG_MAX`、`ULLONG_MAX`

<aside>
💡

C99 的改动让标准库从 15 个头文件增长到 **24 个头文件**，大幅增强了数值计算、国际化和类型安全方面的支持。

</aside>

## 21.4 `<stddef.h>`：常用定义

`<stddef.h>` 提供了几个被标准库广泛使用的**类型**和**宏**：

### 类型定义

- **`ptrdiff_t`**：两个指针相减的结果类型（有符号整数类型）

```c
int a[10];
int *p = &a[0], *q = &a[5];
ptrdiff_t diff = q - p;    // diff = 5
```

- **`size_t`**：`sizeof` 运算符的结果类型（无符号整数类型），广泛用于表示**大小**和**数量**

```c
size_t len = strlen("hello");   // len = 5
```

- **`wchar_t`**：宽字符类型，用于表示扩展字符集中的字符

### 宏定义

- **`NULL`**：空指针常量，通常定义为 `((void *)0)` 或 `0`

```c
int *p = NULL;    // p 不指向任何对象
```

- **`offsetof(type, member)`**：计算结构体成员相对于结构体起始位置的**字节偏移量**

```c
#include <stddef.h>

struct s {
    char a;
    int b;
    double c;
};

size_t off_b = offsetof(struct s, b);   // a 之后可能有填充字节
size_t off_c = offsetof(struct s, c);
```

<aside>
📌

`offsetof` 的返回类型是 `size_t`。它在处理**内存布局**和**序列化**时非常有用，尤其当结构体存在**对齐填充**（padding）时。

</aside>

## 21.5 `<stdbool.h>`：布尔类型和值（C99）

C99 之前，C 语言没有专门的布尔类型，程序员通常用 `int`（0 表示假，非 0 表示真）来模拟。

C99 引入了内置的布尔类型 `_Bool`，而 `<stdbool.h>` 提供了更友好的名称：

### 定义的宏

| 宏 | 展开为 | 说明 |
| --- | --- | --- |
| `bool` | `_Bool` | 布尔类型 |
| `true` | `1` | 逻辑真 |
| `false` | `0` | 逻辑假 |
| `__bool_true_false_are_defined` | `1` | 指示以上宏已定义 |

### 使用示例

```c
#include <stdbool.h>

bool is_even(int n) {
    return n % 2 == 0;
}

int main(void) {
    bool flag = true;
    if (is_even(4)) {
        printf("4 is even\n");
    }
    return 0;
}
```

### `_Bool` 类型的特性

- `_Bool` 只能存储 **0** 或 **1**
- 给 `_Bool` 赋任何**非零值**都会被转换为 **1**

```c
_Bool b;
b = 5;      // b 的值为 1（非零 → 1）
b = 0;      // b 的值为 0
b = -3;     // b 的值为 1（非零 → 1）
```

<aside>
💡

`<stdbool.h>` 是 C99 中最简单的头文件之一，但使用 `bool`/`true`/`false` 可以显著提升代码的**可读性**。建议在 C99 及以后的代码中总是使用它。

</aside>

## 21.6 小结

| 要点 | 说明 |
| --- | --- |
| 标准库的角色 | 提供 C 语言缺少的内建功能（I/O、字符串、数学等），是语言的重要补充 |
| 使用方式 | 通过 `#include` 引入头文件，编译器自动链接库实现 |
| C89 标准库 | 15 个头文件，覆盖基本的 I/O、字符串、数学、内存管理等 |
| C99 新增 | 增加 9 个头文件（共 24 个），强化了数值计算、国际化和类型安全 |
| `<stddef.h>` | 提供 `size_t`、`ptrdiff_t`、`NULL`、`offsetof` 等基础定义 |
| `<stdbool.h>` | C99 引入，提供 `bool`、`true`、`false` 宏，增强可读性 |

> 标准库是 C 语言的**基础设施**。掌握标准库的组织结构和各头文件的职责，是高效使用 C 语言的前提。后续章节（22–27 章）将逐一深入介绍各个库的具体内容。
>