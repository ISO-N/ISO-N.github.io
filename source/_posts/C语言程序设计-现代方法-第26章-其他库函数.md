---
title: ç¬¬26ç«  å…¶ä»–åº“å‡½æ•°
date: 2026-02-17 02:20:35
categories:
- [ç¼–ç¨‹æŠ€æœ¯, C]
tags:
- Cè¯­è¨€ç¨‹åºè®¾è®¡-ç°ä»£æ–¹æ³•
---
## 26.1 `<stdarg.h>` å¤´ï¼šå¯å˜å‚æ•°

### å¯å˜å‚æ•°å‡½æ•°

C è¯­è¨€å…è®¸å®šä¹‰**å‚æ•°æ•°é‡å¯å˜**çš„å‡½æ•°ï¼ˆå¦‚ `printf`ã€`scanf`ï¼‰ã€‚`<stdarg.h>` æä¾›äº†è®¿é—®è¿™äº›é¢å¤–å‚æ•°çš„æœºåˆ¶ã€‚

å¯å˜å‚æ•°å‡½æ•°çš„å£°æ˜ä½¿ç”¨çœç•¥å· `...` è¡¨ç¤ºå¯å˜éƒ¨åˆ†ï¼š

```c
int printf(const char *format, ...);
```

- å¯å˜å‚æ•°å‡½æ•°**è‡³å°‘éœ€è¦ä¸€ä¸ª**å›ºå®šå‚æ•°ï¼ˆåœ¨ `...` ä¹‹å‰ï¼‰
- çœç•¥å· `...` å¿…é¡»å‡ºç°åœ¨å‚æ•°åˆ—è¡¨çš„**æœ€å**

### `va_list` ç±»å‹

`va_list` æ˜¯ä¸€ä¸ªç”¨äºéå†å¯å˜å‚æ•°çš„ç±»å‹ã€‚ä½¿ç”¨å¯å˜å‚æ•°çš„åŸºæœ¬æ­¥éª¤ï¼š

1. å£°æ˜ä¸€ä¸ª `va_list` ç±»å‹çš„å˜é‡
2. ç”¨ `va_start` åˆå§‹åŒ–
3. ç”¨ `va_arg` é€ä¸ªè¯»å–å‚æ•°
4. ç”¨ `va_end` æ¸…ç†

### æ ¸å¿ƒå®

| å® | åŸå‹ | è¯´æ˜ |
| --- | --- | --- |
| `va_start` | `void va_start(va_list ap, last_fixed)` | åˆå§‹åŒ– `ap`ï¼Œ`last_fixed` æ˜¯æœ€åä¸€ä¸ªå›ºå®šå‚æ•°çš„åç§° |
| `va_arg` | `type va_arg(va_list ap, type)` | è¿”å›ä¸‹ä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œå¹¶å°† `ap` æ¨è¿›åˆ°ä¸‹ä¸€ä¸ªå‚æ•° |
| `va_end` | `void va_end(va_list ap)` | æ¸…ç† `ap`ï¼Œè°ƒç”¨åä¸èƒ½å†ä½¿ç”¨ `ap`ï¼ˆé™¤éé‡æ–° `va_start`ï¼‰ |
| `va_copy` | `void va_copy(va_list dest, va_list src)` | å¤åˆ¶ `src` åˆ° `dest`ï¼ˆC99 æ–°å¢ï¼‰ |

### å®Œæ•´ç¤ºä¾‹

```c
#include <stdarg.h>
#include <stdio.h>

// è®¡ç®— n ä¸ªæ•´æ•°çš„æœ€å¤§å€¼
int max_int(int n, ...)
{
    va_list ap;
    va_start(ap, n);       // ç”¨æœ€åä¸€ä¸ªå›ºå®šå‚æ•°åˆå§‹åŒ–

    int max = va_arg(ap, int);  // å–ç¬¬ä¸€ä¸ªå¯å˜å‚æ•°
    for (int i = 1; i < n; i++) {
        int val = va_arg(ap, int);
        if (val > max)
            max = val;
    }

    va_end(ap);            // æ¸…ç†
    return max;
}

int main(void)
{
    printf("Max: %d\n", max_int(4, 10, 30, 20, 5));  // è¾“å‡º: Max: 30
    return 0;
}
```

<aside>
âš ï¸

**ä½¿ç”¨å¯å˜å‚æ•°çš„æ³¨æ„äº‹é¡¹ï¼š**

- `va_arg` çš„ `type` å‚æ•°å¿…é¡»ä¸å®é™…ä¼ å…¥çš„ç±»å‹**åŒ¹é…**ï¼ˆè€ƒè™‘é»˜è®¤å‚æ•°æå‡ï¼š`char`/`short` â†’ `int`ï¼Œ`float` â†’ `double`ï¼‰
- æ²¡æœ‰å†…ç½®æ–¹æ³•çŸ¥é“å¯å˜å‚æ•°çš„**æ•°é‡å’Œç±»å‹**â€”â€”å¿…é¡»é€šè¿‡å›ºå®šå‚æ•°ä¼ è¾¾ï¼ˆå¦‚ `printf` çš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œæˆ–æ˜¾å¼ä¼ å…¥å‚æ•°ä¸ªæ•°ï¼‰
- æ¯æ¬¡ `va_start` å¿…é¡»é…å¯¹ä¸€æ¬¡ `va_end`
- `va_arg` è¯»å–çš„ç±»å‹é”™è¯¯ä¼šå¯¼è‡´**æœªå®šä¹‰è¡Œä¸º**
</aside>

### `va_copy`ï¼ˆC99ï¼‰

`va_copy` ç”¨äºå¤åˆ¶ä¸€ä¸ª `va_list` çš„å½“å‰çŠ¶æ€ï¼Œå…è®¸å¤šæ¬¡éå†å¯å˜å‚æ•°ï¼š

```c
va_list ap, ap_copy;
va_start(ap, last_fixed);
va_copy(ap_copy, ap);    // å¤åˆ¶å½“å‰ä½ç½®

// ç¬¬ä¸€æ¬¡éå†ç”¨ ap
// ç¬¬äºŒæ¬¡éå†ç”¨ ap_copy

va_end(ap);
va_end(ap_copy);          // ä¸¤ä¸ªéƒ½éœ€è¦ va_end
```

---

## 26.2 `<stdlib.h>` å¤´ï¼šé€šç”¨å·¥å…·å‡½æ•°

`<stdlib.h>` æ˜¯ C æ ‡å‡†åº“ä¸­æœ€"æ‚"çš„å¤´æ–‡ä»¶ï¼ŒåŒ…å«æ•°å€¼è½¬æ¢ã€ä¼ªéšæœºæ•°ç”Ÿæˆã€å†…å­˜ç®¡ç†ã€ä¸æ“ä½œç³»ç»Ÿé€šä¿¡ã€æœç´¢ä¸æ’åºã€æ•´æ•°è¿ç®—ç­‰å¤šç±»åŠŸèƒ½ã€‚æœ¬ç« é‡ç‚¹å…³æ³¨ä¹‹å‰ç« èŠ‚æœªè¯¦ç»†è®¨è®ºçš„éƒ¨åˆ†ã€‚

### 26.2.1 æ•°å€¼è½¬æ¢å‡½æ•°

#### `atoi` / `atol` / `atoll` ç³»åˆ—

```c
int atoi(const char *s);
long atol(const char *s);
long long atoll(const char *s);    // C99
```

- å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹åº”çš„æ•´æ•°å€¼
- è·³è¿‡å‰å¯¼ç©ºç™½ï¼Œé‡åˆ°éæ³•å­—ç¬¦åœæ­¢
- æº¢å‡ºæ—¶è¡Œä¸º**æœªå®šä¹‰**

#### `strtol` / `strtoul` / `strtoll` / `strtoull` ç³»åˆ—

```c
long strtol(const char *s, char **endptr, int base);
unsigned long strtoul(const char *s, char **endptr, int base);
long long strtoll(const char *s, char **endptr, int base);      // C99
unsigned long long strtoull(const char *s, char **endptr, int base);  // C99
```

- `base`ï¼šè¿›åˆ¶ï¼ˆ2â€“36ï¼‰ï¼Œ`0` è¡¨ç¤ºè‡ªåŠ¨æ£€æµ‹ï¼ˆ`0x` ä¸º 16 è¿›åˆ¶ï¼Œ`0` å¼€å¤´ä¸º 8 è¿›åˆ¶ï¼Œå¦åˆ™ 10 è¿›åˆ¶ï¼‰
- `endptr`ï¼šè‹¥é `NULL`ï¼ŒæŒ‡å‘è½¬æ¢åœæ­¢ä½ç½®çš„æŒ‡é’ˆ
- æº¢å‡ºæ—¶è®¾ç½® `errno` ä¸º `ERANGE`ï¼Œè¿”å› `LONG_MAX`/`LONG_MIN` ç­‰

```c
char *end;
long val = strtol("  123abc", &end, 10);
// val == 123, *end == 'a'
```

<aside>
ğŸ’¡

æ¨èä½¿ç”¨ `strtol` ç³»åˆ—è€Œé `atoi` ç³»åˆ—ï¼Œå› ä¸º `strtol` æä¾›äº†**é”™è¯¯æ£€æµ‹**ï¼ˆé€šè¿‡ `endptr` å’Œ `errno`ï¼‰å’Œ**è¿›åˆ¶æŒ‡å®š**åŠŸèƒ½ã€‚

</aside>

#### `strtod` / `strtof` / `strtold`

```c
double strtod(const char *s, char **endptr);
float strtof(const char *s, char **endptr);          // C99
long double strtold(const char *s, char **endptr);    // C99
```

- å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæµ®ç‚¹æ•°
- æ”¯æŒåå…­è¿›åˆ¶æµ®ç‚¹æ ¼å¼ï¼ˆC99ï¼‰ï¼šå¦‚ `"0x1.8p1"` è¡¨ç¤º 3.0

### 26.2.2 ä¼ªéšæœºæ•°ç”Ÿæˆ

```c
int rand(void);
void srand(unsigned int seed);
```

- `rand()` è¿”å› `0` åˆ° `RAND_MAX` ä¹‹é—´çš„ä¼ªéšæœºæ•´æ•°
- `srand(seed)` è®¾ç½®éšæœºæ•°ç§å­ï¼Œç›¸åŒç§å­äº§ç”Ÿç›¸åŒåºåˆ—
- `RAND_MAX` è‡³å°‘ä¸º **32767**

```c
#include <stdlib.h>
#include <time.h>

srand((unsigned int)time(NULL));  // ç”¨å½“å‰æ—¶é—´ä½œç§å­
int r = rand() % 100;            // 0-99 çš„éšæœºæ•°
```

<aside>
ğŸ“Œ

`rand()` çš„è´¨é‡å› å®ç°è€Œå¼‚ï¼Œä¸é€‚åˆå¯†ç å­¦ç­‰å¯¹éšæœºæ€§è¦æ±‚é«˜çš„åœºæ™¯ã€‚ç”Ÿæˆ `[a, b]` èŒƒå›´å†…çš„æ•´æ•°ï¼š`a + rand() % (b - a + 1)`ï¼ˆæ³¨æ„ï¼šå½“èŒƒå›´ä¸èƒ½æ•´é™¤ `RAND_MAX+1` æ—¶ä¼šæœ‰è½»å¾®åå·®ï¼‰ã€‚

</aside>

### 26.2.3 ä¸æ“ä½œç³»ç»Ÿçš„é€šä¿¡

#### `exit` å’Œ `atexit`

```c
void exit(int status);
int atexit(void (*func)(void));
```

- `exit(status)` ç»ˆæ­¢ç¨‹åºï¼š
    1. è°ƒç”¨æ‰€æœ‰é€šè¿‡ `atexit` æ³¨å†Œçš„å‡½æ•°ï¼ˆæŒ‰**æ³¨å†Œçš„ç›¸åé¡ºåº**ï¼‰
    2. åˆ·æ–°å¹¶å…³é—­æ‰€æœ‰æ‰“å¼€çš„æµ
    3. åˆ é™¤é€šè¿‡ `tmpfile` åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶
    4. å°† `status` è¿”å›ç»™æ“ä½œç³»ç»Ÿ
- `atexit(func)` æ³¨å†Œä¸€ä¸ªåœ¨ç¨‹åºæ­£å¸¸ç»ˆæ­¢æ—¶è°ƒç”¨çš„å‡½æ•°ï¼Œæœ€å¤šå¯æ³¨å†Œ **32** ä¸ª

```c
void cleanup(void)
{
    printf("Cleaning up...\n");
}

int main(void)
{
    atexit(cleanup);
    // ... ç¨‹åºé€»è¾‘
    exit(EXIT_SUCCESS);   // ä¼šå…ˆè°ƒç”¨ cleanup
}
```

#### `_Exit`ï¼ˆC99ï¼‰

```c
void _Exit(int status);
```

- ç«‹å³ç»ˆæ­¢ç¨‹åºï¼Œ**ä¸è°ƒç”¨** `atexit` æ³¨å†Œçš„å‡½æ•°ï¼Œä¹Ÿä¸åˆ·æ–°æµ
- ç”¨äºéœ€è¦å¿«é€Ÿé€€å‡ºçš„åœºæ™¯ï¼ˆå¦‚ `fork` åçš„å­è¿›ç¨‹ï¼‰

#### `abort`

```c
void abort(void);
```

- å¼‚å¸¸ç»ˆæ­¢ç¨‹åºï¼ˆè§¦å‘ `SIGABRT` ä¿¡å·ï¼‰
- æ˜¯å¦åˆ·æ–°æµã€å…³é—­æ–‡ä»¶ç”±å®ç°å®šä¹‰

#### `system`

```c
int system(const char *command);
```

- å°† `command` ä¼ é€’ç»™æ“ä½œç³»ç»Ÿçš„å‘½ä»¤å¤„ç†å™¨ï¼ˆshellï¼‰æ‰§è¡Œ
- è‹¥ `command` ä¸º `NULL`ï¼Œè¿”å›éé›¶å€¼è¡¨ç¤ºå‘½ä»¤å¤„ç†å™¨å¯ç”¨
- è¿”å›å€¼å–å†³äºå®ç°ï¼ˆé€šå¸¸æ˜¯å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ï¼‰

```c
system("ls -la");          // Unix/Linux
system("dir");             // Windows
```

#### `getenv`

```c
char *getenv(const char *name);
```

- è·å–ç¯å¢ƒå˜é‡çš„å€¼ï¼Œæœªæ‰¾åˆ°è¿”å› `NULL`

```c
char *path = getenv("PATH");
if (path != NULL)
    printf("PATH = %s\n", path);
```

### 26.2.4 æœç´¢ä¸æ’åº

#### `qsort`

```c
void qsort(void *base, size_t nmemb, size_t size,
           int (*compar)(const void *, const void *));
```

- å¯¹æ•°ç»„è¿›è¡ŒåŸåœ°æ’åº
- `base`ï¼šæ•°ç»„é¦–åœ°å€
- `nmemb`ï¼šå…ƒç´ ä¸ªæ•°
- `size`ï¼šæ¯ä¸ªå…ƒç´ çš„å­—èŠ‚å¤§å°
- `compar`ï¼šæ¯”è¾ƒå‡½æ•°ï¼Œè¿”å› **è´Ÿæ•°**ï¼ˆa < bï¼‰ã€**é›¶**ï¼ˆa == bï¼‰ã€**æ­£æ•°**ï¼ˆa > bï¼‰

```c
int compare_ints(const void *a, const void *b)
{
    return (*(const int *)a) - (*(const int *)b);
}

int arr[] = {5, 2, 8, 1, 9};
qsort(arr, 5, sizeof(int), compare_ints);
// arr: {1, 2, 5, 8, 9}
```

#### `bsearch`

```c
void *bsearch(const void *key, const void *base, size_t nmemb,
              size_t size, int (*compar)(const void *, const void *));
```

- åœ¨**å·²æ’åº**çš„æ•°ç»„ä¸­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾
- æ‰¾åˆ°è¿”å›åŒ¹é…å…ƒç´ çš„æŒ‡é’ˆï¼Œæœªæ‰¾åˆ°è¿”å› `NULL`

```c
int key = 8;
int *result = bsearch(&key, arr, 5, sizeof(int), compare_ints);
if (result)
    printf("Found: %d\n", *result);
```

<aside>
âš ï¸

`bsearch` è¦æ±‚æ•°ç»„**å·²æŒ‰ç›¸åŒçš„æ¯”è¾ƒå‡½æ•°æ’åº**ã€‚å¦‚æœæ•°ç»„æœªæ’åºï¼Œç»“æœæ˜¯æœªå®šä¹‰çš„ã€‚é€šå¸¸å…ˆ `qsort` å† `bsearch`ã€‚

</aside>

### 26.2.5 æ•´æ•°è¿ç®—å‡½æ•°

```c
int abs(int n);
long labs(long n);
long long llabs(long long n);        // C99

div_t div(int numer, int denom);
ldiv_t ldiv(long numer, long denom);
lldiv_t lldiv(long long numer, long long denom);  // C99
```

- `abs`/`labs`/`llabs`ï¼šè¿”å›ç»å¯¹å€¼
- `div`/`ldiv`/`lldiv`ï¼šåŒæ—¶è®¡ç®—å•†å’Œä½™æ•°ï¼Œè¿”å›åŒ…å« `quot`ï¼ˆå•†ï¼‰å’Œ `rem`ï¼ˆä½™æ•°ï¼‰çš„ç»“æ„ä½“

```c
div_t result = div(17, 5);
printf("17 / 5 = %d ä½™ %d\n", result.quot, result.rem);
// è¾“å‡º: 17 / 5 = 3 ä½™ 2
```

<aside>
ğŸ’¡

`div` çš„ä¼˜åŠ¿ï¼šC89 ä¸­ `/` å’Œ `%` å¯¹è´Ÿæ•°çš„æˆªæ–­æ–¹å‘ç”±å®ç°å®šä¹‰ï¼Œä½† `div` ä¿è¯å‘é›¶æˆªæ–­ã€‚C99 ä¹‹å `/` å’Œ `%` ä¹Ÿä¿è¯å‘é›¶æˆªæ–­ï¼Œæ‰€ä»¥ `div` åœ¨ C99 ä¸­ä¸»è¦ç”¨äºåŒæ—¶éœ€è¦å•†å’Œä½™æ•°çš„åœºæ™¯ï¼ˆå¯èƒ½æ›´é«˜æ•ˆï¼‰ã€‚

</aside>

### 26.2.6 å¤šå­—èŠ‚/å®½å­—ç¬¦è½¬æ¢å‡½æ•°

è¿™äº›å‡½æ•°åœ¨ç¬¬ 25 ç« å›½é™…åŒ–ç‰¹æ€§ä¸­å·²è¯¦ç»†ä»‹ç»ï¼š

- `mblen`ã€`mbtowc`ã€`wctomb` â€” å•ä¸ªå­—ç¬¦è½¬æ¢
- `mbstowcs`ã€`wcstombs` â€” å­—ç¬¦ä¸²è½¬æ¢

---

## 26.3 `<time.h>` å¤´ï¼šæ—¥æœŸå’Œæ—¶é—´

### æ—¶é—´çš„è¡¨ç¤ºæ–¹å¼

`<time.h>` ä½¿ç”¨ä¸¤ç§æ–¹å¼è¡¨ç¤ºæ—¶é—´ï¼š

| ç±»å‹ | è¯´æ˜ |
| --- | --- |
| `time_t` | **æ—¥å†æ—¶é—´**ï¼Œé€šå¸¸æ˜¯ä» 1970-01-01 00:00:00 UTC èµ·ç»è¿‡çš„ç§’æ•°ï¼ˆç®—æœ¯ç±»å‹ï¼‰ |
| `struct tm` | **åˆ†è§£æ—¶é—´**ï¼Œå°†æ—¶é—´æ‹†åˆ†ä¸ºå¹´ã€æœˆã€æ—¥ã€æ—¶ã€åˆ†ã€ç§’ç­‰å„ä¸ªåˆ†é‡ |
| `clock_t` | **å¤„ç†å™¨æ—¶é—´**ï¼Œç”¨äºè¡¡é‡ç¨‹åºçš„ CPU ä½¿ç”¨æ—¶é—´ |

### `struct tm` çš„æˆå‘˜

| æˆå‘˜ | ç±»å‹ | èŒƒå›´ | è¯´æ˜ |
| --- | --- | --- | --- |
| `tm_sec` | `int` | 0â€“60 | ç§’ï¼ˆ60 ç”¨äºé—°ç§’ï¼‰ |
| `tm_min` | `int` | 0â€“59 | åˆ† |
| `tm_hour` | `int` | 0â€“23 | æ—¶ |
| `tm_mday` | `int` | 1â€“31 | æ—¥ |
| `tm_mon` | `int` | 0â€“11 | æœˆï¼ˆ0 = ä¸€æœˆï¼‰ |
| `tm_year` | `int` | â€” | å¹´ï¼ˆä» 1900 èµ·çš„å¹´æ•°ï¼‰ |
| `tm_wday` | `int` | 0â€“6 | æ˜ŸæœŸå‡ ï¼ˆ0 = æ˜ŸæœŸæ—¥ï¼‰ |
| `tm_yday` | `int` | 0â€“365 | ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤© |
| `tm_isdst` | `int` | â€” | å¤ä»¤æ—¶æ ‡å¿—ï¼ˆæ­£å€¼=ç”Ÿæ•ˆï¼Œ0=æœªç”Ÿæ•ˆï¼Œè´Ÿå€¼=æœªçŸ¥ï¼‰ |

### è·å–æ—¶é—´

```c
time_t time(time_t *timer);
```

- è¿”å›å½“å‰çš„æ—¥å†æ—¶é—´ï¼ˆ`time_t`ï¼‰
- è‹¥ `timer` é `NULL`ï¼ŒåŒæ—¶å°†ç»“æœå­˜å…¥ `*timer`
- æ— æ³•è·å–æ—¶é—´æ—¶è¿”å› `(time_t)-1`

```c
time_t now = time(NULL);
```

### æ—¶é—´è½¬æ¢å‡½æ•°

```c
struct tm *localtime(const time_t *timer);  // time_t â†’ æœ¬åœ°æ—¶é—´ struct tm
struct tm *gmtime(const time_t *timer);     // time_t â†’ UTC æ—¶é—´ struct tm
time_t mktime(struct tm *timeptr);          // struct tm â†’ time_t
```

- `localtime` å’Œ `gmtime` è¿”å›æŒ‡å‘é™æ€ `struct tm` çš„æŒ‡é’ˆï¼ˆ**éçº¿ç¨‹å®‰å…¨**ï¼‰
- `mktime` ä¼š**è§„èŒƒåŒ–** `struct tm` çš„æˆå‘˜ï¼ˆå¦‚ `tm_mday` è®¾ä¸º 32 ä¼šè‡ªåŠ¨è¿›ä½åˆ°ä¸‹æœˆï¼‰ï¼Œå¹¶å¡«å…… `tm_wday` å’Œ `tm_yday`

```c
time_t now = time(NULL);
struct tm *local = localtime(&now);
printf("å½“å‰æ—¶é—´: %då¹´%dæœˆ%dæ—¥ %02d:%02d:%02d\n",
       local->tm_year + 1900, local->tm_mon + 1, local->tm_mday,
       local->tm_hour, local->tm_min, local->tm_sec);
```

<aside>
ğŸ’¡

`mktime` çš„è§„èŒƒåŒ–ç‰¹æ€§éå¸¸å®ç”¨â€”â€”å¯ä»¥ç”¨æ¥åšæ—¥æœŸè¿ç®—ã€‚ä¾‹å¦‚ï¼Œæƒ³çŸ¥é“"ä»Šå¤©å†è¿‡ 100 å¤©æ˜¯å‡ å·"ï¼š

```c
struct tm *t = localtime(&now);
t->tm_mday += 100;   // å¯èƒ½è¶…å‡ºåˆæ³•èŒƒå›´
mktime(t);            // mktime ä¼šè‡ªåŠ¨è§„èŒƒåŒ–
```

</aside>

### æ—¶é—´æ ¼å¼åŒ–

#### `asctime` å’Œ `ctime`

```c
char *asctime(const struct tm *timeptr);
char *ctime(const time_t *timer);
```

- éƒ½è¿”å›å›ºå®šæ ¼å¼çš„å­—ç¬¦ä¸²ï¼š`"Wed Jun 15 21:30:05 2025\n"`
- `ctime(&t)` ç­‰ä»·äº `asctime(localtime(&t))`
- è¿”å›æŒ‡å‘é™æ€ç¼“å†²åŒºçš„æŒ‡é’ˆï¼ˆéçº¿ç¨‹å®‰å…¨ï¼‰

#### `strftime`ï¼ˆæ¨èï¼‰

```c
size_t strftime(char *s, size_t maxsize, const char *format, const struct tm *timeptr);
```

- æ ¹æ®æ ¼å¼å­—ç¬¦ä¸²å°† `struct tm` è½¬æ¢ä¸ºè‡ªå®šä¹‰æ ¼å¼çš„å­—ç¬¦ä¸²
- è¿”å›å†™å…¥çš„å­—ç¬¦æ•°ï¼ˆä¸å«ç»ˆæ­¢ç¬¦ï¼‰ï¼›è‹¥ç¼“å†²åŒºä¸å¤Ÿè¿”å› 0

å¸¸ç”¨æ ¼å¼è¯´æ˜ç¬¦ï¼š

| è¯´æ˜ç¬¦ | å«ä¹‰ | ç¤ºä¾‹ |
| --- | --- | --- |
| `%Y` | å››ä½å¹´ä»½ | `2025` |
| `%m` | æœˆï¼ˆ01â€“12ï¼‰ | `06` |
| `%d` | æ—¥ï¼ˆ01â€“31ï¼‰ | `15` |
| `%H` | æ—¶ï¼ˆ00â€“23ï¼‰ | `21` |
| `%M` | åˆ†ï¼ˆ00â€“59ï¼‰ | `30` |
| `%S` | ç§’ï¼ˆ00â€“60ï¼‰ | `05` |
| `%A` | æ˜ŸæœŸå…¨å | `Wednesday` |
| `%a` | æ˜ŸæœŸç¼©å†™ | `Wed` |
| `%B` | æœˆä»½å…¨å | `June` |
| `%b` | æœˆä»½ç¼©å†™ | `Jun` |
| `%p` | AM/PM | `PM` |
| `%Z` | æ—¶åŒºå | `CST` |
| `%%` | å­—é¢ `%` | `%` |

```c
char buf[100];
strftime(buf, sizeof(buf), "%Y-%m-%d %H:%M:%S", localtime(&now));
printf("%s\n", buf);  // è¾“å‡º: 2025-06-15 21:30:05
```

### æ—¶é—´å·®è®¡ç®—

```c
double difftime(time_t time1, time_t time0);
```

- è¿”å› `time1 - time0` çš„ç§’æ•°ï¼ˆ`double` ç±»å‹ï¼‰
- è™½ç„¶ `time_t` é€šå¸¸æ˜¯æ•´æ•°ï¼Œä½†æ ‡å‡†ä¸ä¿è¯å¯ä»¥ç›´æ¥ç›¸å‡ï¼Œåº”ä½¿ç”¨ `difftime`

```c
time_t start = time(NULL);
// ... æ‰§è¡ŒæŸäº›æ“ä½œ
time_t end = time(NULL);
printf("è€—æ—¶: %.0f ç§’\n", difftime(end, start));
```

### å¤„ç†å™¨æ—¶é—´

```c
clock_t clock(void);
```

- è¿”å›ç¨‹åºå¯åŠ¨ä»¥æ¥çš„**å¤„ç†å™¨æ—¶é—´**ï¼ˆCPU æ—¶é—´ï¼‰
- éœ€é™¤ä»¥ `CLOCKS_PER_SEC` è½¬æ¢ä¸ºç§’
- æ— æ³•è·å–æ—¶è¿”å› `(clock_t)-1`

```c
clock_t start = clock();
// ... å¤§é‡è®¡ç®—
clock_t end = clock();
double cpu_time = (double)(end - start) / CLOCKS_PER_SEC;
printf("CPU æ—¶é—´: %f ç§’\n", cpu_time);
```

<aside>
ğŸ“Œ

`clock()` æµ‹é‡çš„æ˜¯ **CPU æ—¶é—´**ï¼ˆç¨‹åºå®é™…å ç”¨å¤„ç†å™¨çš„æ—¶é—´ï¼‰ï¼Œè€Œ `time()` æµ‹é‡çš„æ˜¯**å¢™é’Ÿæ—¶é—´**ï¼ˆçœŸå®ä¸–ç•Œç»è¿‡çš„æ—¶é—´ï¼‰ã€‚å¦‚æœç¨‹åºä¸­æœ‰ `sleep` æˆ–ç­‰å¾… I/Oï¼Œ`clock()` ä¸ä¼šè®¡å…¥ç­‰å¾…æ—¶é—´ï¼Œä½† `time()` ä¼šã€‚

</aside>

---

## 26.4 å°ç»“

| å¤´æ–‡ä»¶ | ç”¨é€” | å…³é”®å†…å®¹ |
| --- | --- | --- |
| `<stdarg.h>` | å¯å˜å‚æ•° | `va_list`ã€`va_start`ã€`va_arg`ã€`va_end`ã€`va_copy` |
| `<stdlib.h>` | é€šç”¨å·¥å…· | æ•°å€¼è½¬æ¢ã€éšæœºæ•°ã€`exit`/`atexit`/`system`/`getenv`ã€`qsort`/`bsearch`ã€æ•´æ•°è¿ç®— |
| `<time.h>` | æ—¥æœŸå’Œæ—¶é—´ | `time_t`/`struct tm`ã€`time`/`localtime`/`mktime`/`strftime`/`difftime`/`clock` |

> ç¬¬ 26 ç« è¦†ç›–äº† C æ ‡å‡†åº“ä¸­ä¸å±äºå…¶ä»–ä¸“é—¨ç« èŠ‚çš„"æ‚é¡¹"åŠŸèƒ½ã€‚`<stdarg.h>` ä½¿å‡½æ•°èƒ½æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼Œ`<stdlib.h>` æä¾›äº†ä»æ•°å€¼è½¬æ¢åˆ°æœç´¢æ’åºçš„å¤šç§é€šç”¨å·¥å…·ï¼Œ`<time.h>` åˆ™æä¾›äº†å®Œæ•´çš„æ—¥æœŸæ—¶é—´å¤„ç†èƒ½åŠ›ã€‚è¿™äº›åº“å‡½æ•°è™½ç„¶"æ‚"ï¼Œä½†éƒ½æ˜¯æ—¥å¸¸ C ç¼–ç¨‹ä¸­**é«˜é¢‘ä½¿ç”¨**çš„å·¥å…·ã€‚
>