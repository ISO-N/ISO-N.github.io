---
title: 第12章 基本数据类型
date: 2026-02-17 15:25:01
categories:
- [软件工程, 理论]
tags:
- 代码大全
---
本章讨论使用基本数据类型（如整数、浮点数、字符串、布尔值、枚举、常量等）时的最佳实践。

---

## 12.1 数值概论

- 避免使用"**魔术数**"（Magic Number），应使用**具名常量**代替
- 预防**除零错误**
- 使类型转换变得**明显**，避免隐式转换带来的隐患
- 注意不同语言中整数除法的**截断**行为

## 12.2 整数

- 检查**整数除法**：整数除法会截断小数部分，`7/10` 结果为 `0` 而非 `0.7`
- 检查**整数溢出**：当运算结果超出类型范围时，可能产生不可预料的结果
- 检查**中间结果溢出**：即使最终结果在范围内，中间运算也可能溢出

## 12.3 浮点数

- 避免将**量级相差巨大**的数相加减（小数可能被"吞掉"）
- 避免**等量判断**：浮点数有精度误差，不要用 `==` 直接比较，应使用一个足够小的精度范围（epsilon）来判断
- 处理**舍入误差累积**：循环中的浮点累加可能逐步偏离真实值
- 换用更高精度类型（如 `double` 替代 `float`），或使用**专用库**（如 `BigDecimal`）处理精度敏感的场景（如金融计算）

## 12.4 字符和字符串

- 避免使用魔术字符和魔术字符串，用**具名常量**代替
- 注意 **Unicode** 和国际化（i18n）问题
    - 决定程序是否需要支持多字节字符集
    - 考虑本地化策略（例如字符串外置到资源文件）
- 了解语言和环境中字符串的**索引起点**是 0 还是 1
- 注意 **C 语言**中字符串的特殊问题：
    - 区分字符串指针和字符数组
    - 用 `strncpy()` 代替 `strcpy()` 防止缓冲区溢出
    - 确保字符串以 `\0`（null 终止符）结尾

## 12.5 布尔变量

- 使用布尔变量来**简化复杂条件判断**
    - 将复杂表达式拆解并赋给有意义的布尔变量，提升可读性
- 用布尔变量**记录程序状态**，如 `isFound`、`isDone`
- 为布尔变量取**含义明确的名字**
    - 推荐使用肯定性名称：`isFound` 优于 `isNotFound`（双重否定 `if (!isNotFound)` 极难阅读）

## 12.6 枚举类型

- 使用枚举来提高**可读性**
    - 枚举成员名可自解释，如 [`Color.Red`](http://Color.Red) 比数字 `1` 清晰
- 使用枚举来提高**可靠性**
    - 编译器可以做类型检查，防止非法值
- 使用枚举来简化**修改**
    - 新增或删除成员只需改枚举定义
- 将枚举用作**布尔变量的替代**
    - 当可能出现第三种状态时，枚举比 `true/false` 更灵活
- 留意枚举的**陷阱**
    - 不要将枚举当作整数使用
    - 定义出**非法值**或**"首/尾"标记**便于循环和错误处理
    - 将枚举的第一个元素保留为无效值

## 12.7 具名常量

- 在数据声明中使用具名常量，避免到处硬编码字面值
- 统一管理具名常量（如放在专门的头文件或常量类中）
- 避免使用字面量，即使是"看起来安全的"值（如 `0`、`1`）
- 用**具名常量**而不是具有常量值的变量来模拟常量——确保值不会被意外修改

## 12.8 数组

- 确保所有数组下标**没有越界**
- 考虑用**容器类**（如 `ArrayList`、`Map`）替代数组——提供自动边界检查和动态大小
- 注意数组的**索引起点**：不同语言从 0 或 1 开始
- 多维数组要注意**下标顺序**（行 vs 列），避免混淆
- 小心 **off-by-one**（差一错误）——数组循环的终止条件极易出错

## 12.9 创建你自己的类型（类型别名）

- 为什么要创建自定义类型？
    - 使代码更加**自文档化**：`typedef float Coordinate` 比裸 `float` 含义更清晰
    - 便于**统一修改**：若需将 `float` 改为 `double`，只需修改一处定义
    - 提高**可移植性**：不同平台上类型大小可能不同
- 创建自定义类型的指导原则
    - 给类型取**功能导向**的名字：`Velocity` 优于 `LongFloat`
    - 避免重新定义**预定义类型**
    - 不要将自定义类型与语言的标准类型混用

---

<aside>
📌

**核心原则**：选择数据类型时，应始终以**可读性**、**可靠性**和**可维护性**为目标。善用语言提供的类型系统和编译器检查，尽早暴露错误。

</aside>