---
title: 第4章 表达式
date: 2026-02-17 02:20:21
categories:
- [编程技术, C]
---
## 4.1 算术运算符

C 语言提供五个**算术运算符**（二元）：

| 运算符 | 含义 | 示例 |
| --- | --- | --- |
| `+` | 加法 | `5 + 3` → `8` |
| `-` | 减法 | `5 - 3` → `2` |
| `*` | 乘法 | `5 * 3` → `15` |
| `/` | 除法 | `7 / 2` → `3`（整数除法） |
| `%` | 取余 | `7 % 2` → `1` |

### 运算符的优先级与结合性

- `*`、`/`、`%` 优先级高于 `+`、`-`
- 同优先级运算符**从左到右**结合
- 可使用括号 `()` 改变运算顺序

```c
1 + 2 * 3      // 结果为 7，不是 9
(1 + 2) * 3    // 结果为 9
```

### 一元运算符

- **一元正号** `+`：无实际效果
- **一元负号** `-`：取相反数

一元运算符优先级**高于**二元算术运算符。

### 整数除法与取余

<aside>
⚠️

两个**整数**相除时，结果会**截断小数部分**（向零取整）：

- `7 / 2` → `3`（不是 `3.5`）
- `-7 / 2` → `-3`（C99 规定向零截断）

如果需要浮点结果，至少有一个操作数为浮点类型：`7.0 / 2` → `3.5`

</aside>

取余运算符 `%` 只能用于**整数**操作数：

```c
10 % 3    // 结果为 1
-10 % 3   // C99 规定结果为 -1（余数与被除数同号）
```

### 由实现定义的行为

- 在 C89 中，当操作数有负值时，`/` 和 `%` 的结果是**由实现定义的**（implementation-defined）
- C99 明确规定：整数除法向零截断，`%` 的结果与被除数同号

## 4.2 赋值运算符

### 简单赋值

```c
int i;
i = 5;      // 将 5 赋给 i
```

- 赋值运算符 `=` 的右侧是表达式，左侧必须是**左值**（lvalue），通常是变量
- **赋值是表达式**，有返回值（即被赋的值），所以可以链式赋值：

```c
i = j = k = 0;  // 等价于 i = (j = (k = 0))
```

<aside>
💡

赋值运算符的结合性是**从右到左**。

</aside>

### 复合赋值

C 提供了 10 种复合赋值运算符，将运算与赋值合并：

```c
i += 5;     // 等价于 i = i + 5
i -= 3;     // 等价于 i = i - 3
i *= 2;     // 等价于 i = i * 2
i /= 4;     // 等价于 i = i / 4
i %= 3;     // 等价于 i = i % 3
```

<aside>
📌

复合赋值的一般形式：`v op= e` 等价于 `v = v op (e)`。注意 `e` 外面隐含括号，例如 `i *= j + 1` 等价于 `i = i * (j + 1)`，而**不是** `i = i * j + 1`。

</aside>

## 4.3 自增和自减运算符

- `++i`（**前缀自增**）：先加 1，再使用 `i` 的值
- `i++`（**后缀自增**）：先使用 `i` 的值，再加 1
- `--i`（**前缀自减**）：先减 1，再使用 `i` 的值
- `i--`（**后缀自减**）：先使用 `i` 的值，再减 1

```c
int i = 1;
printf("%d\n", ++i);   // 输出 2，此时 i == 2
printf("%d\n", i++);   // 输出 2，此时 i == 3
```

<aside>
⚠️

**避免在同一表达式中对同一变量多次使用自增/自减**，例如 `a = i++ + ++i;` 的行为是**未定义的**（undefined behavior），不同编译器可能给出不同结果。

</aside>

## 4.4 表达式求值

### 子表达式的求值顺序

- C 语言**不保证**大多数运算符的操作数的求值顺序
- 例如 `(a + b) * (c - d)` 中，`a + b` 和 `c - d` 哪个先求值是未指定的
- 例外：`&&`、`||`、`?:` 和 `,`（逗号）运算符保证从左到右求值

### 未定义行为

当表达式中对同一变量既有读取又有修改时，可能导致**未定义行为**：

```c
c = (b = a + 2) - (a = 1);  // 未定义行为！
```

<aside>
📌

经验法则：**不要在一个表达式中既修改变量又在其他地方使用该变量的值**。

</aside>

## 4.5 表达式语句

在 C 语言中，任何表达式后面加上分号 `;` 就变成了**表达式语句**：

```c
i = 1;        // 赋值表达式语句
i++;          // 自增表达式语句
printf("Hi"); // 函数调用表达式语句
```

- 表达式语句执行时，先求表达式的值，然后**丢弃**该值
- 因此，像 `i + 1;` 这样的语句虽然合法，但毫无意义（计算了结果却没使用）

> 理解"**表达式**"和"**语句**"的区别是掌握 C 语言的关键：表达式有值，语句执行动作。表达式加上分号就变成了语句。
>