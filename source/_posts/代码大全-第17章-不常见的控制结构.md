---
title: 第17章 不常见的控制结构
date: 2026-02-17 15:25:05
categories:
- [软件工程, 理论]
tags:
- 代码大全
---
本章讨论了几种不太常用但在特定场景下有价值的控制结构：**多处返回**、**递归**、**goto** 以及 **表驱动方法中的异常处理**。核心观点是——了解这些结构的利弊，在合适的时候谨慎使用。

---

## 17.1 子程序中的多处返回（Multiple Returns from a Routine）

- `return` 语句可以在子程序的任意位置退出，而不必等到末尾
- **适用场景**：
    - 检测到错误时立即返回（**卫语句 / Guard Clause**），可以减少嵌套层级
    - 在找到答案后立即返回，避免不必要的后续计算
- **使用原则**：
    - 每个 `return` 都应当使代码 **更易读**，而非更难读
    - 尽量减少每个子程序中 return 的数量，控制复杂度
    - 在子程序开头使用卫语句处理边界情况是一种好的实践

<aside>
💡

卫语句示例：在函数开头先检查无效输入并返回，再处理正常逻辑，可以有效降低嵌套深度，提升可读性。

</aside>

---

## 17.2 递归（Recursion）

- 递归是指子程序调用自身来解决问题
- **适用场景**：
    - 问题本身具有递归性质（如树的遍历、排序算法、迷宫回溯等）
    - 递归方案比迭代方案 **更简洁、更易理解** 时
- **使用递归的注意事项**：
    1. **确保递归能停止**：必须有明确的基准情况（Base Case），且每次递归调用都在向基准情况靠近
    2. **使用安全计数器防止无限递归**：在调试和防御性编程中，加入递归深度计数器
    3. **将递归限制在一个子程序内**：避免 A 调 B、B 再调 A 的间接递归，这会大幅增加理解难度
    4. **留意栈空间**：递归深度过大会导致栈溢出
    5. **不要用递归去计算阶乘或斐波那契**：这类问题用简单循环更高效，递归反而引入不必要的开销

<aside>
⚠️

如果递归使代码更复杂而非更简单，就应该改用迭代方案。递归不是炫技工具，而是在特定场景下简化问题的手段。

</aside>

---

## 17.3 goto 语句

这是本章篇幅最大的一节，也是编程史上争议最多的话题之一。

### 反对 goto 的论点

- Dijkstra 在 1968 年发表的经典论文《Go To Statement Considered Harmful》开启了这一讨论
- goto 会破坏代码的顺序性和结构化，使程序流程难以追踪
- 大量 goto 的代码可靠性更差、更难维护和优化
- 现代控制结构（`if-else`、`while`、`for`、`try-catch`）几乎可以替代所有 goto 的用途

### 支持 goto 的论点

- 在某些场景下，goto 可以消除重复代码或减少嵌套
- 某些语言（如早期 Fortran、汇编）缺乏完善的控制结构，goto 是必要的
- 在性能关键的代码中，goto 有时比结构化替代方案更高效

### goto 的合理使用场景

在极少数情况下，goto 可以被接受：

- **从嵌套循环中跳出**：当多层嵌套循环需要一次性跳出时，如果语言不支持 `break label`
- **资源清理和公共退出点**：在 C 语言中，goto 常用于跳转到函数末尾的统一清理代码段
- **错误处理的集中出口**：类似于 `try-finally` 的效果

### McConnell 的建议

- 如果你的语言提供了等效的结构化方案，就不要用 goto
- 如果必须用 goto，只 **向前跳转**，不要向后跳转（向后跳转容易产生隐含的循环）
- 确保 goto 的使用使代码 **更清晰**，而非更混乱
- 每次使用 goto 都应当深思熟虑，并考虑是否有更好的替代方案

---

## 17.4 针对不常见控制结构的观点（Perspective）

- 对于"不常见的控制结构"，关键原则是 **可读性优先**
- 选择控制结构时，应考虑：
    - 这段代码别人能读懂吗？
    - 这种写法是否是最简单、最直接的表达方式？
    - 是否容易维护和修改？
- 不要因为某种技巧存在就使用它，也不要因为它不常见就拒绝它

---

## 本章核心要点总结

| **控制结构** | **推荐程度** | **关键建议** |
| --- | --- | --- |
| 多处返回 | ✅ 适度使用 | 用卫语句降低嵌套，但不要过多 |
| 递归 | ✅ 按需使用 | 确保有基准情况，注意栈空间，简单问题用迭代 |
| goto | ⚠️ 尽量避免 | 仅在缺乏替代方案且能提升可读性时使用，只向前跳 |

<aside>
📖

**一句话总结**：不常见的控制结构不是禁区，但使用它们的唯一理由应该是让代码更简单、更清晰。如果做不到，就用常规结构。

</aside>