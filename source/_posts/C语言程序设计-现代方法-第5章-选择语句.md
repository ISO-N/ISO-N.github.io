---
title: 第5章 选择语句
date: 2026-02-17 02:20:22
categories:
- [编程技术, C]
tags:
- C语言程序设计-现代方法
---
## 5.1 逻辑表达式

C 语言提供三种逻辑运算符用于构建条件：

### 关系运算符

| 运算符 | 含义 | 示例 |
| --- | --- | --- |
| `<` | 小于 | `5 < 10` → `1` |
| `>` | 大于 | `5 > 10` → `0` |
| `<=` | 小于等于 | `5 <= 5` → `1` |
| `>=` | 大于等于 | `5 >= 10` → `0` |

### 判等运算符

| 运算符 | 含义 | 示例 |
| --- | --- | --- |
| `==` | 等于 | `5 == 5` → `1` |
| `!=` | 不等于 | `5 != 3` → `1` |

<aside>
⚠️

注意区分 `=`（赋值）和 `==`（判等）。`if (i = 0)` 不是判断 `i` 是否为 0，而是将 0 赋给 `i`，条件永远为假！

</aside>

### 逻辑运算符

| 运算符 | 含义 | 示例 |
| --- | --- | --- |
| `!` | 逻辑非 | `!0` → `1`，`!5` → `0` |
| `&&` | 逻辑与 | `1 && 1` → `1`，`1 && 0` → `0` |
| `||` | 逻辑或 | `0 || 1` → `1`，`0 || 0` → `0` |
- 关系运算符和判等运算符产生 `0`（假）或 `1`（真）
- C 语言中，**任何非零值都为真，零为假**
- 优先级：`!` > 关系运算符（`<` `>` `<=` `>=`）> 判等运算符（`==` `!=`）> `&&` > `||`

### 短路求值

`&&` 和 `||` 具有**短路求值**（short-circuit evaluation）特性：

- `expr1 && expr2`：若 `expr1` 为假，**不再求值** `expr2`
- `expr1 || expr2`：若 `expr1` 为真，**不再求值** `expr2`

```c
// 利用短路求值避免除零错误
if (d != 0 && n / d > 0)
    printf("商为正数\n");
```

## 5.2 if 语句

### 基本形式

```c
if (表达式)
    语句
```

如果表达式的值非零（真），则执行语句；否则跳过。

### if-else 形式

```c
if (表达式)
    语句1
else
    语句2
```

表达式为真执行语句1，否则执行语句2。

### 复合语句（块）

当需要在 `if` 或 `else` 后执行多条语句时，用花括号 `{}` 包裹成**复合语句**：

```c
if (grade >= 60) {
    printf("及格\n");
    pass_count++;
} else {
    printf("不及格\n");
    fail_count++;
}
```

<aside>
💡

即使只有一条语句，加上花括号也是好习惯，可以避免后续添加语句时忘记加括号的 bug。

</aside>

### 级联式 if

用于多路分支判断：

```c
if (score >= 90)
    printf("优秀\n");
else if (score >= 80)
    printf("良好\n");
else if (score >= 70)
    printf("中等\n");
else if (score >= 60)
    printf("及格\n");
else
    printf("不及格\n");
```

### 悬空 else 问题

```c
if (y != 0)
    if (x != 0)
        result = x / y;
else    // 这个 else 与哪个 if 配对？
    printf("Error!\n");
```

<aside>
⚠️

C 语言规定 `else` 与**最近的未匹配 `if`** 配对。上面的 `else` 属于内层 `if (x != 0)`，而不是外层 `if (y != 0)`。用花括号可以消除歧义。

</aside>

正确写法：

```c
if (y != 0) {
    if (x != 0)
        result = x / y;
} else {
    printf("Error!\n");
}
```

## 5.3 条件表达式

**条件运算符** `?:` 是 C 语言唯一的**三元运算符**：

```c
expr1 ? expr2 : expr3
```

- 若 `expr1` 为真，求值并返回 `expr2`
- 否则，求值并返回 `expr3`

```c
int max = (a > b) ? a : b;          // 取较大值
printf("You have %d item%s.\n", n, n == 1 ? "" : "s");
```

<aside>
📌

条件表达式的优先级很低（仅高于赋值和逗号运算符），复杂表达式中建议加括号提高可读性。

</aside>

## 5.4 布尔值

### C89 中的布尔值

C89 没有布尔类型，通常用 `int` 变量存储布尔值，或用宏定义：

```c
#define TRUE  1
#define FALSE 0

int flag = TRUE;
```

### C99 中的 _Bool 类型

C99 新增了 `_Bool` 类型，只能存储 `0` 或 `1`：

```c
_Bool flag = 1;
```

同时提供了 `<stdbool.h>` 头文件，定义了更友好的名称：

```c
#include <stdbool.h>

bool flag = true;   // bool、true、false 均为宏
flag = false;
```

## 5.5 switch 语句

`switch` 用于多路分支，适合对**同一变量**进行多个**离散值**的判断：

```c
switch (表达式) {
    case 常量表达式1:
        语句
        break;
    case 常量表达式2:
        语句
        break;
    ...
    default:
        语句
        break;
}
```

### 关键规则

- **控制表达式**：必须是**整数类型**（包括 `char`），不能是浮点数或字符串
- **case 标签**：必须是**整数常量表达式**（字面量、`#define` 常量、枚举常量），不能是变量
- **break**：跳出 `switch`。如果省略 `break`，执行会**贯穿**（fall through）到下一个 `case`
- **default**：可选，匹配所有未命中的情况

### 示例

```c
switch (grade) {
    case 4:  printf("优秀\n");  break;
    case 3:  printf("良好\n");  break;
    case 2:  printf("中等\n");  break;
    case 1:  printf("及格\n");  break;
    case 0:  printf("不及格\n"); break;
    default: printf("非法成绩\n"); break;
}
```

### 多个 case 共享同一语句

```c
switch (ch) {
    case 'a': case 'e': case 'i': case 'o': case 'u':
        printf("元音\n");
        break;
    default:
        printf("辅音\n");
        break;
}
```

<aside>
⚠️

**忘记 `break` 是 `switch` 语句中最常见的错误。** 除非有意利用贯穿特性，否则每个 `case` 末尾都应加上 `break`。

</aside>

> `if` 语句适合**范围判断**和**复杂条件**，`switch` 语句适合对**离散值**的多路分支——选择哪种取决于具体场景。
>