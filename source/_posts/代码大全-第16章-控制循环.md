---
title: 第16章 控制循环
date: 2026-02-17 15:25:05
categories:
- [软件工程, 理论]
tags:
- 代码大全
---
## 16.1 选择循环的种类

循环是控制程序重复执行某段代码的结构。常见循环种类：

- **计数循环（Counted Loop）**：执行固定次数，如 `for i = 1 to 10`
- **连续求值循环（Continuously Evaluated Loop）**：每次迭代前或后判断是否继续，如 `while` / `do-while`
- **无限循环（Endless Loop）**：使用 `while(true)` 配合内部 `break` 退出
- **迭代器循环（Iterator Loop）**：对集合中的每个元素执行操作，如 `foreach`

> 选择循环种类时，应选择最能清晰表达循环意图的类型。
> 

---

## 16.2 用 while 循环控制循环

`while` 循环是最灵活的循环结构，适用于不确定迭代次数的场景。

### 在循环开头测试（while）

- 如果条件一开始就不满足，循环体**一次都不执行**
- 适用于"零次或多次"执行的场景

### 在循环末尾测试（do-while / do-until）

- 循环体**至少执行一次**
- 适用于"一次或多次"执行的场景
- 使用较少，可读性通常不如 `while` 循环

<aside>
💡

**建议**：优先使用 `while` 循环（开头测试），因为它更易于理解和正确使用。

</aside>

---

## 16.3 用 for 循环控制循环

`for` 循环适合**循环次数已知**的简单场景。

- 在 `for` 循环头部就能看到初始化、条件和递增，便于一目了然地理解循环
- **不要在循环体内修改循环变量**——这会使循环难以理解
- **不要在循环体内使用循环变量作为下标之外的用途**
- 如果循环逻辑复杂（如提前退出、跳过迭代等），考虑改用 `while` 循环

---

## 16.4 用 foreach 循环控制循环

- `foreach` 隐藏了循环的计数和索引细节，减少出错机会
- 适合遍历集合中所有元素的场景
- 比手动管理索引的 `for` 循环更安全、更简洁

---

## 16.5 循环控制

循环控制是本章最关键的部分。循环容易出错，需要谨慎处理。

### 进入循环

- **从一个位置进入循环**：只从循环头部进入，不要用 `goto` 跳入循环中间
- 把初始化代码紧放在循环前面，不要让初始化代码与循环之间隔得太远

### 处理循环体

- **用 `{` `}` 把循环体括起来**，即使只有一行——防止后续维护出错
- **避免空循环体**，如果循环体为空，说明代码结构可能有问题
- **把循环内务操作（housekeeping）放在循环开头或末尾**，而非散布在中间
- **一个循环只做一件事**——如果一个循环在做两件不相关的事，考虑拆分

### 退出循环

- **让循环终止条件显而易见**——确保一眼就能看出循环何时结束
- **不要为了终止循环而修改 `for` 循环的索引值**——如果需要提前退出，用 `break`
- **避免依赖循环索引的终值**——循环结束后循环变量的值在不同语言中可能不同
- **使用安全计数器（safety counter）**防止无限循环——在不确定的循环中加入最大迭代次数保护

### 使用 break 和 continue

- `break` 用于在某个条件满足时提前退出循环
- `continue` 用于跳过当前迭代的剩余部分，进入下一次迭代
- 使用 `break` 和 `continue` 时要小心——**过多的 `break` 会使循环逻辑难以理解**
- 如果循环中有多个 `break`，考虑是否应该重构循环

<aside>
⚠️

**警告**：警惕把 `break` 当成偷懒的手段。如果你发现在一个循环中使用了多个 `break`，请重新审视循环的设计。

</aside>

### 检查端点

- 手动检查循环的**首次迭代**、**最后一次迭代**和**中间的典型迭代**
- 确认循环在**零次迭代**情况下是否正确（空集合、空列表等）
- 检查循环的**边界条件**（off-by-one error 是最常见的循环错误）

---

## 16.6 轻松创建循环——由内而外

创建复杂循环的策略：

1. **从一个具体情况开始**——先写出一次迭代的处理代码
2. **再用循环包装**——把特定值替换为循环变量
3. **把初始化和边界处理加上**——处理第一次和最后一次迭代的特殊情况

> 由内而外地构建循环比试图一次写出完整循环容易得多，也不容易出错。
> 

---

## 16.7 循环与数组的关系

循环和数组经常一起使用，常见的模式包括：

- **遍历数组所有元素**
- **搜索特定元素**
- **对数组进行变换或累积操作**

注意数组的下标范围，避免数组越界——这与循环边界条件密切相关。

---

## 16.8 本章小结（核心检查清单）

- [ ]  循环的种类是否合适？（`for` / `while` / `foreach`）
- [ ]  循环是否只从头部进入？
- [ ]  初始化代码是否紧邻循环？
- [ ]  循环体是否用花括号包围？
- [ ]  循环是否只做一件事？
- [ ]  循环终止条件是否显而易见？
- [ ]  是否检查了 off-by-one 错误？
- [ ]  是否避免了在循环体内修改循环变量？
- [ ]  是否对关键循环设置了安全计数器？
- [ ]  循环是否高效？（不必要的计算是否移出了循环？）