---
title: 第13章 字符串
date: 2026-02-17 02:20:27
categories:
- [编程技术, C]
tags:
- C语言程序设计-现代方法
---
## 13.1 字符串字面量

- 字符串字面量（string literal）是用双引号括起来的字符序列，如 `"Hello, World!"`
- 编译器会将字符串字面量作为字符数组存储，并在末尾自动添加空字符 `\0`
- `"Hello"` 实际占 6 个字节：`H` `e` `l` `l` `o` `\0`

### 转义序列

- 字符串字面量中可以包含转义序列，如 `\n`（换行）、`\t`（制表符）、`\\`（反斜杠）、`\"`（双引号）等

### 延续字符串字面量

有三种方式将长字符串分成多行：

- **反斜杠续行**：在行尾使用 `\`，下一行必须从行首开始

```c
printf("This is a very long \
string.\n");
```

- **相邻字符串字面量自动合并**：编译器会将相邻的字符串字面量拼接

```c
printf("This is a very long "
       "string.\n");
```

### 字符串字面量的存储

- 字符串字面量被当作 `char *` 类型的指针
- 可以对字符串字面量使用指针运算：`"abc"[1]` 的值是 `'b'`
- **不要试图修改字符串字面量**，行为是未定义的：

```c
char *p = "abc";
*p = 'A';  // 未定义行为！
```

### 字符串字面量与字符常量

- `"a"` 是字符串字面量（指向包含 `'a'` 和 `'\0'` 的数组的指针）
- `'a'` 是字符常量（一个整数值）
- 两者**不可互换**

---

## 13.2 字符串变量

- C 语言没有专门的"字符串类型"，字符串存储在**字符数组**中
- 任何一维字符数组都可以存储字符串，但必须以空字符 `\0` 结尾

### 声明字符串变量

```c
#define STR_LEN 80
char str[STR_LEN + 1];  // +1 为空字符预留空间
```

### 初始化字符串变量

```c
char date1[8] = "June 14";            // 编译器自动添加 \0
char date2[8] = {'J','u','n','e',' ','1','4','\0'};  // 等价写法
char date3[] = "June 14";             // 编译器自动计算长度为 8
```

- 如果初始化值比数组短，剩余元素初始化为 `\0`
- 如果初始化值（不含 `\0`）等于数组长度，则不会存储 `\0`（此时不是合法字符串！）

### 字符数组与字符指针

```c
char date[] = "June 14";   // 数组，内容可修改
char *date = "June 14";    // 指针，指向字符串字面量，不可修改内容
```

关键区别：

- `char date[]` — 数组中存储了字符串的**副本**，可以修改
- `char *date` — 指针指向字符串字面量，修改内容是**未定义行为**
- 声明为指针时，`date` 可以指向其他字符串；声明为数组时，`date` 是数组名，不可重新赋值

---

## 13.3 字符串的读和写

### 用 `printf` 和 `puts` 写字符串

```c
char str[] = "Hello";
printf("%s\n", str);       // 输出: Hello
printf("%.3s\n", str);     // 输出: Hel（限制最多打印 3 个字符）
printf("%-10s\n", str);    // 左对齐，宽度 10
puts(str);                 // 输出字符串并自动换行
```

### 用 `scanf` 和 `gets` 读字符串

- `scanf` 配合 `%s`：跳过前导空白，读到下一个空白字符为止

```c
char str[STR_LEN + 1];
scanf("%s", str);          // 不需要 &，数组名即地址
```

- `scanf` **不会读入空格**，只读一个"单词"
- **`gets` 函数**（C11 已移除）：读取整行直到换行符，不存储换行符

```c
gets(str);                 // 危险！无法限制输入长度，可能缓冲区溢出
```

- 更安全的替代：`fgets`

```c
fgets(str, sizeof(str), stdin);  // 最多读 sizeof(str)-1 个字符
```

### 逐个字符读字符串

```c
int read_line(char str[], int n) {
    int ch, i = 0;
    while ((ch = getchar()) != '\n')
        if (i < n)
            str[i++] = ch;
    str[i] = '\0';
    return i;
}
```

---

## 13.4 访问字符串中的字符

- 字符串存储在数组中，可以用下标或指针逐个访问字符
- 常见模式 — 遍历字符串：

```c
// 下标方式
for (int i = 0; str[i] != '\0'; i++)
    // 处理 str[i]

// 指针方式
for (char *p = str; *p != '\0'; p++)
    // 处理 *p
```

---

## 13.5 使用 C 语言的字符串库

- 头文件 `<string.h>` 提供了丰富的字符串操作函数
- **不能对字符串直接使用运算符**（如 `=`、`==`、`<`），必须使用库函数

### `strcpy` — 字符串复制

```c
char str1[10], str2[10];
strcpy(str1, "abc");          // str1 = "abc"
strcpy(str2, str1);           // str2 = "abc"
```

- 不检查目标数组大小，可能溢出
- 更安全：`strncpy(str1, str2, sizeof(str1) - 1);`

### `strlen` — 字符串长度

```c
size_t len = strlen("abc");   // 返回 3（不包含 \0）
```

### `strcat` — 字符串拼接

```c
char str[20] = "Hello";
strcat(str, ", ");
strcat(str, "World!");        // str = "Hello, World!"
```

- 更安全：`strncat(str, src, n);` 最多追加 n 个字符

### `strcmp` — 字符串比较

```c
if (strcmp(str1, str2) == 0)        // str1 == str2
if (strcmp(str1, str2) < 0)         // str1 < str2（字典序）
if (strcmp(str1, str2) > 0)         // str1 > str2
```

- 按字典序（基于字符的 ASCII 值）逐字符比较
- 返回值：负数、0 或正数

---

## 13.6 字符串惯用法

### 搜索字符串末尾

```c
// 惯用法1：循环后 p 指向 \0
size_t my_strlen(const char *s) {
    const char *p = s;
    while (*p)    // 等价于 *p != '\0'
        p++;
    return p - s;
}
```

### 复制字符串

```c
// 惯用法：简洁的 strcpy 实现
void my_strcpy(char *dst, const char *src) {
    while (*dst++ = *src++)
        ;
}
```

---

## 13.7 字符串数组

### 二维字符数组

```c
char planets[][8] = {
    "Mercury", "Venus", "Earth", "Mars",
    "Jupiter", "Saturn", "Uranus", "Neptune"
};
```

- 每行固定长度，短字符串会浪费空间

### 指针数组（更常用）

```c
const char *planets[] = {
    "Mercury", "Venus", "Earth", "Mars",
    "Jupiter", "Saturn", "Uranus", "Neptune"
};
```

- 每个元素是指向字符串字面量的指针，不浪费空间
- 但不能修改字符串内容

### 命令行参数

```c
int main(int argc, char *argv[]) {
    // argc: 命令行参数个数（含程序名）
    // argv[0]: 程序名
    // argv[1] ~ argv[argc-1]: 各参数
}
```

示例：运行 `./program -d file.txt`

- `argc` = 3
- `argv[0]` = `"./program"`
- `argv[1]` = `"-d"`
- `argv[2]` = `"file.txt"`

---

## 本章要点速查

| **概念** | **要点** |
| --- | --- |
| 字符串本质 | 以 `\0` 结尾的字符数组 |
| 字面量存储 | 只读区域，不可修改 |
| `char[]` vs `char*` | 数组可修改副本；指针指向字面量不可改 |
| 读写函数 | `printf/scanf`、`puts/gets`（`gets` 已废弃，用 `fgets`） |
| 核心库函数 | `strlen`、`strcpy`、`strcat`、`strcmp` |
| 字符串数组 | 二维数组（固定宽度）或指针数组（节省空间） |
| 命令行参数 | `argc` 计数、`argv[]` 字符串数组 |